"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.Electrolizer = exports.ElectrolizerType = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _electron = require("electron");

var _drivers = require("./drivers");

var ElectrolizerType;
exports.ElectrolizerType = ElectrolizerType;

(function (ElectrolizerType) {
  ElectrolizerType["webview"] = "webview";
  ElectrolizerType["browserView"] = "browserView";
  ElectrolizerType["browserWindow"] = "browserWindow";
})(ElectrolizerType || (exports.ElectrolizerType = ElectrolizerType = {}));

class Electrolizer {
  constructor(bus) {
    this.bus = bus;
    (0, _defineProperty2.default)(this, "interactionReady", false);
    (0, _defineProperty2.default)(this, "queue", []);
    (0, _defineProperty2.default)(this, "driver", void 0);
    (0, _defineProperty2.default)(this, "cookies", {
      clearAll: () => {
        this._queue(() => this.driver.cookies.clearAll());

        return this;
      },
      get: arg => {
        return this.driver.cookies.get(arg);
      },
      set: (name, value) => {
        //@ts-ignore
        this._queue(() => this.driver.cookies.set(name, value));

        return this;
      },
      clear: name => {
        this._queue(() => this.driver.cookies.clear(name));

        return this;
      }
    });
    this.setupDriver();
  }

  setupDriver() {
    switch (this.busType) {
      case ElectrolizerType.webview:
        this.driver = new _drivers.WebviewTagDriver(this.bus);
        break;

      case ElectrolizerType.browserWindow:
        this.driver = new _drivers.BrowserWindowDriver(this.bus);
        break;

      case ElectrolizerType.browserView:
        this.driver = new _drivers.BrowserViewDriver(this.bus);
        break;
    }
  }

  get busType() {
    try {
      var instanceOfTest = this.bus instanceof _electron.BrowserView;
    } catch (error) {
      return ElectrolizerType.webview;
    }

    if (this.bus instanceof _electron.BrowserView) {
      return ElectrolizerType.browserView;
    }

    if (this.bus instanceof _electron.BrowserWindow) {
      return ElectrolizerType.browserWindow;
    }

    return ElectrolizerType.webview;
  }

  _queue(fn) {
    this.queue.push(fn);
  }

  goto(url, headers) {
    this._queue(this.driver.goto.bind(this.driver, url, headers));

    return this;
  }

  back() {
    this._queue(this.driver.back.bind(this.driver));

    return this;
  }

  forward() {
    this._queue(this.driver.forward.bind(this.driver));

    return this;
  }

  refresh() {
    this._queue(this.driver.refresh.bind(this.driver));

    return this;
  }

  click(selector) {
    this._queue(this.driver.click.bind(this.driver, selector));

    return this;
  }

  mousedown(selector) {
    this._queue(this.driver.mousedown.bind(this.driver, selector));

    return this;
  }

  mouseup(selector) {
    this._queue(this.driver.mouseup.bind(this.driver, selector));

    return this;
  }

  mouseover(selector) {
    this._queue(this.driver.mouseover.bind(this.driver, selector));

    return this;
  }

  mouseout(selector) {
    this._queue(this.driver.mouseout.bind(this.driver, selector));

    return this;
  }

  type(selector, text) {
    this._queue(this.driver.type.bind(this.driver, selector, text));

    return this;
  }

  insert(selector, text) {
    this._queue(this.driver.insert.bind(this.driver, selector, text));

    return this;
  }

  check(selector) {
    this._queue(this.driver.check.bind(this.driver, selector));

    return this;
  }

  uncheck(selector) {
    this._queue(this.driver.uncheck.bind(this.driver, selector));

    return this;
  }

  select(selector, option) {
    this._queue(this.driver.select.bind(this.driver, selector, option));

    return this;
  }

  scrollTo(top, left) {
    this._queue(this.driver.scrollTo.bind(this.driver, top, left));

    return this;
  }

  viewport(width, height) {
    this._queue(this.driver.viewport.bind(this.driver, width, height));

    return this;
  }

  inject(type, file) {
    this._queue(this.driver.inject.bind(this.driver, type, file));

    return this;
  }

  exists(selector) {
    var _this = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this.run();
      return yield _this.driver.exists(selector);
    })();
  }

  html() {
    var _this2 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this2.run();
      return yield _this2.driver.html();
    })();
  }

  evaluate(fn) {
    var _arguments = arguments,
        _this3 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      for (var _len = _arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
        args[_key - 1] = _arguments[_key];
      }

      yield _this3.run();
      return _this3.driver.evaluate(fn, ...args);
    })();
  }

  wait() {
    //@ts-ignore
    this._queue(() => this.driver.wait.apply(this.driver, arguments));

    return this;
  }

  header(header, value) {
    return this;
  }

  authentication(username, password) {
    this._queue(this.driver.authentication.bind(this.driver, username, password));

    return this;
  }

  useragent(useragent) {
    this._queue(this.driver.useragent.bind(this.driver, useragent));

    return this;
  }

  run() {
    var _this4 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      for (var block of _this4.queue) {
        yield block();
      }

      _this4.queue = [];
    })();
  }

  end() {
    var _this5 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _this5.run();
    })();
  }

}

exports.Electrolizer = Electrolizer;
var _default = Electrolizer;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lbGVjdHJvbGl6ZXIuY2xhc3MudHMiXSwibmFtZXMiOlsiRWxlY3Ryb2xpemVyVHlwZSIsIkVsZWN0cm9saXplciIsImNvbnN0cnVjdG9yIiwiYnVzIiwiY2xlYXJBbGwiLCJfcXVldWUiLCJkcml2ZXIiLCJjb29raWVzIiwiZ2V0IiwiYXJnIiwic2V0IiwibmFtZSIsInZhbHVlIiwiY2xlYXIiLCJzZXR1cERyaXZlciIsImJ1c1R5cGUiLCJ3ZWJ2aWV3IiwiV2Vidmlld1RhZ0RyaXZlciIsImJyb3dzZXJXaW5kb3ciLCJCcm93c2VyV2luZG93RHJpdmVyIiwiYnJvd3NlclZpZXciLCJCcm93c2VyVmlld0RyaXZlciIsImluc3RhbmNlT2ZUZXN0IiwiQnJvd3NlclZpZXciLCJlcnJvciIsIkJyb3dzZXJXaW5kb3ciLCJmbiIsInF1ZXVlIiwicHVzaCIsImdvdG8iLCJ1cmwiLCJoZWFkZXJzIiwiYmluZCIsImJhY2siLCJmb3J3YXJkIiwicmVmcmVzaCIsImNsaWNrIiwic2VsZWN0b3IiLCJtb3VzZWRvd24iLCJtb3VzZXVwIiwibW91c2VvdmVyIiwibW91c2VvdXQiLCJ0eXBlIiwidGV4dCIsImluc2VydCIsImNoZWNrIiwidW5jaGVjayIsInNlbGVjdCIsIm9wdGlvbiIsInNjcm9sbFRvIiwidG9wIiwibGVmdCIsInZpZXdwb3J0Iiwid2lkdGgiLCJoZWlnaHQiLCJpbmplY3QiLCJmaWxlIiwiZXhpc3RzIiwicnVuIiwiaHRtbCIsImV2YWx1YXRlIiwiYXJncyIsIndhaXQiLCJhcHBseSIsImFyZ3VtZW50cyIsImhlYWRlciIsImF1dGhlbnRpY2F0aW9uIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsInVzZXJhZ2VudCIsImJsb2NrIiwiZW5kIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUE7O0FBR0E7O0lBSVlBLGdCOzs7V0FBQUEsZ0I7QUFBQUEsRUFBQUEsZ0I7QUFBQUEsRUFBQUEsZ0I7QUFBQUEsRUFBQUEsZ0I7R0FBQUEsZ0Is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LEdBQWEsRUFBYjtBQUx5QjtBQU0xQjs7QUFFSzRDLEVBQUFBLEdBQU4sR0FBMkI7QUFBQTs7QUFBQTtBQUN6QixNQUFBLE1BQUksQ0FBQ2IsR0FBTDtBQUR5QjtBQUUxQjs7QUE1TXlIOzs7ZUErTTdHekQsWSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJyb3dzZXJWaWV3LCBCcm93c2VyV2luZG93LCBXZWJ2aWV3VGFnLCBXZWJDb250ZW50cyB9IGZyb20gJ2VsZWN0cm9uJztcbmltcG9ydCB7IE9wZXJhdG9yRnVuY3Rpb25zIH0gZnJvbSAnLi9vcGVyYXRvci1mdW5jdGlvbnMuaW50ZXJmYWNlJztcbmltcG9ydCB7IHNlcmllcyB9IGZyb20gJ2FzeW5jJztcbmltcG9ydCB7IFdlYnZpZXdUYWdEcml2ZXIsIEJyb3dzZXJWaWV3RHJpdmVyLCBCcm93c2VyV2luZG93RHJpdmVyIH0gZnJvbSAnLi9kcml2ZXJzJztcbmltcG9ydCB7IFB1c2ggfSBmcm9tICcuL2V2YWx1YXRlLWZ1bmN0aW9uLnR5cGUnO1xuaW1wb3J0IHsgQ29va2llcyB9IGZyb20gJy4vZHJpdmVycy9jb29raWVzLmludGVyZmFjZSc7XG5cbmV4cG9ydCBlbnVtIEVsZWN0cm9saXplclR5cGUge1xuICB3ZWJ2aWV3ID0gJ3dlYnZpZXcnLFxuICBicm93c2VyVmlldyA9ICdicm93c2VyVmlldycsXG4gIGJyb3dzZXJXaW5kb3cgPSAnYnJvd3NlcldpbmRvdydcbn1cblxuXG5leHBvcnQgY2xhc3MgRWxlY3Ryb2xpemVyPFQgZXh0ZW5kcyBXZWJ2aWV3VGFnIHwgQnJvd3NlclZpZXcgfCBCcm93c2VyV2luZG93PiBpbXBsZW1lbnRzIE9wZXJhdG9yRnVuY3Rpb25zPEVsZWN0cm9saXplcjxUPj4ge1xuXG4gIGludGVyYWN0aW9uUmVhZHk6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBxdWV1ZTogKCgpID0+IFByb21pc2U8YW55PilbXSA9IFtdO1xuXG4gIGRyaXZlciE6IFdlYnZpZXdUYWdEcml2ZXIgfCBCcm93c2VyV2luZG93RHJpdmVyIHwgQnJvd3NlclZpZXdEcml2ZXI7XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIGJ1czogVCl7XG4gICAgdGhpcy5zZXR1cERyaXZlcigpO1xuICB9XG5cbiAgY29va2llczogQ29va2llczxFbGVjdHJvbGl6ZXI8VD4+ID0ge1xuICAgIGNsZWFyQWxsOiAoKSA9PiB7IFxuICAgICAgdGhpcy5fcXVldWUoICgpID0+IHRoaXMuZHJpdmVyLmNvb2tpZXMuY2xlYXJBbGwoKSApO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBnZXQ6IChhcmc6IGFueSkgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuZHJpdmVyLmNvb2tpZXMuZ2V0KGFyZylcbiAgICB9LFxuICAgIHNldDogKG5hbWU6IHN0cmluZyB8IEVsZWN0cm9uLkNvb2tpZSwgdmFsdWU/OiBzdHJpbmcpID0+IHtcbiAgICAgIC8vQHRzLWlnbm9yZVxuICAgICAgdGhpcy5fcXVldWUoKCkgPT4gdGhpcy5kcml2ZXIuY29va2llcy5zZXQobmFtZSwgdmFsdWUpKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgY2xlYXI6IChuYW1lPzogc3RyaW5nKSA9PiB7XG4gICAgICB0aGlzLl9xdWV1ZSgoKSA9PiB0aGlzLmRyaXZlci5jb29raWVzLmNsZWFyKG5hbWUpKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gIH1cblxuICBcbiAgcHJpdmF0ZSBzZXR1cERyaXZlcigpe1xuICAgIHN3aXRjaCh0aGlzLmJ1c1R5cGUpe1xuICAgICAgY2FzZSBFbGVjdHJvbGl6ZXJUeXBlLndlYnZpZXc6XG4gICAgICAgIHRoaXMuZHJpdmVyID0gbmV3IFdlYnZpZXdUYWdEcml2ZXIodGhpcy5idXMgYXMgV2Vidmlld1RhZyk7XG4gICAgICBicmVhaztcbiAgICAgIFxuICAgICAgY2FzZSBFbGVjdHJvbGl6ZXJUeXBlLmJyb3dzZXJXaW5kb3c6XG4gICAgICAgIHRoaXMuZHJpdmVyID0gbmV3IEJyb3dzZXJXaW5kb3dEcml2ZXIodGhpcy5idXMgYXMgQnJvd3NlcldpbmRvdyk7XG4gICAgICBicmVhaztcblxuICAgICAgY2FzZSBFbGVjdHJvbGl6ZXJUeXBlLmJyb3dzZXJWaWV3OlxuICAgICAgICB0aGlzLmRyaXZlciA9IG5ldyBCcm93c2VyVmlld0RyaXZlcih0aGlzLmJ1cyBhcyBCcm93c2VyVmlldyk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIFxuICBnZXQgYnVzVHlwZSgpOiBFbGVjdHJvbGl6ZXJUeXBlIHtcbiAgICB0cnkge1xuICAgICAgbGV0IGluc3RhbmNlT2ZUZXN0ID0gdGhpcy5idXMgaW5zdGFuY2VvZiBCcm93c2VyVmlldztcbiAgICB9IGNhdGNoKGVycm9yKXtcbiAgICAgIHJldHVybiBFbGVjdHJvbGl6ZXJUeXBlLndlYnZpZXc7XG4gICAgfVxuXG4gICAgaWYodGhpcy5idXMgaW5zdGFuY2VvZiBCcm93c2VyVmlldyl7XG4gICAgICByZXR1cm4gRWxlY3Ryb2xpemVyVHlwZS5icm93c2VyVmlldztcbiAgICB9XG5cbiAgICBpZih0aGlzLmJ1cyBpbnN0YW5jZW9mIEJyb3dzZXJXaW5kb3cpe1xuICAgICAgcmV0dXJuIEVsZWN0cm9saXplclR5cGUuYnJvd3NlcldpbmRvdztcbiAgICB9XG5cbiAgICByZXR1cm4gRWxlY3Ryb2xpemVyVHlwZS53ZWJ2aWV3O1xuICB9XG4gIFxuICBwcml2YXRlIF9xdWV1ZShmbjogKCkgPT4gUHJvbWlzZTxhbnk+KXtcbiAgICB0aGlzLnF1ZXVlLnB1c2goZm4pO1xuICB9XG5cbiAgZ290byh1cmw6IHN0cmluZywgaGVhZGVycz86IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMuX3F1ZXVlKHRoaXMuZHJpdmVyLmdvdG8uYmluZCh0aGlzLmRyaXZlciwgdXJsLCBoZWFkZXJzKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBiYWNrKCk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIuYmFjay5iaW5kKHRoaXMuZHJpdmVyKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBmb3J3YXJkKCk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIuZm9yd2FyZC5iaW5kKHRoaXMuZHJpdmVyKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICByZWZyZXNoKCk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIucmVmcmVzaC5iaW5kKHRoaXMuZHJpdmVyKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBjbGljayhzZWxlY3Rvcjogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLl9xdWV1ZSh0aGlzLmRyaXZlci5jbGljay5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgbW91c2Vkb3duKHNlbGVjdG9yOiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMuX3F1ZXVlKHRoaXMuZHJpdmVyLm1vdXNlZG93bi5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgbW91c2V1cChzZWxlY3Rvcjogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLl9xdWV1ZSh0aGlzLmRyaXZlci5tb3VzZXVwLmJpbmQodGhpcy5kcml2ZXIsIHNlbGVjdG9yKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBtb3VzZW92ZXIoc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIubW91c2VvdmVyLmJpbmQodGhpcy5kcml2ZXIsIHNlbGVjdG9yKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBtb3VzZW91dChzZWxlY3Rvcjogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLl9xdWV1ZSh0aGlzLmRyaXZlci5tb3VzZW91dC5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgdHlwZShzZWxlY3Rvcjogc3RyaW5nLCB0ZXh0Pzogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLl9xdWV1ZSh0aGlzLmRyaXZlci50eXBlLmJpbmQodGhpcy5kcml2ZXIsIHNlbGVjdG9yLCB0ZXh0KSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBpbnNlcnQoc2VsZWN0b3I6IHN0cmluZywgdGV4dD86IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIuaW5zZXJ0LmJpbmQodGhpcy5kcml2ZXIsIHNlbGVjdG9yLCB0ZXh0KSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBjaGVjayhzZWxlY3Rvcjogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLl9xdWV1ZSh0aGlzLmRyaXZlci5jaGVjay5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgdW5jaGVjayhzZWxlY3Rvcjogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLl9xdWV1ZSh0aGlzLmRyaXZlci51bmNoZWNrLmJpbmQodGhpcy5kcml2ZXIsIHNlbGVjdG9yKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzZWxlY3Qoc2VsZWN0b3I6IHN0cmluZywgb3B0aW9uPzogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLl9xdWV1ZSh0aGlzLmRyaXZlci5zZWxlY3QuYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IsIG9wdGlvbikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgc2Nyb2xsVG8odG9wOiBudW1iZXIsIGxlZnQ6IG51bWJlcik6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIuc2Nyb2xsVG8uYmluZCh0aGlzLmRyaXZlciwgdG9wLCBsZWZ0KSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICB2aWV3cG9ydCh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcik6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIudmlld3BvcnQuYmluZCh0aGlzLmRyaXZlciwgd2lkdGgsIGhlaWdodCkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgaW5qZWN0KHR5cGU6ICdqcycgfCAnY3NzJywgZmlsZTogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLl9xdWV1ZSh0aGlzLmRyaXZlci5pbmplY3QuYmluZCh0aGlzLmRyaXZlciwgdHlwZSwgZmlsZSkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYXN5bmMgZXhpc3RzKHNlbGVjdG9yOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBhd2FpdCB0aGlzLnJ1bigpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmRyaXZlci5leGlzdHMoc2VsZWN0b3IpO1xuICB9XG5cbiAgYXN5bmMgaHRtbCgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGF3YWl0IHRoaXMucnVuKCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZHJpdmVyLmh0bWwoKTtcbiAgfVxuXG4gIGFzeW5jIGV2YWx1YXRlPFQsIEsgZXh0ZW5kcyBhbnlbXSwgUj4oZm46ICguLi5hcmdzOiBQdXNoPEssIFQ+KSA9PiBSLCAuLi5hcmdzOiBLKTogUHJvbWlzZTxSPiB7XG4gICAgYXdhaXQgdGhpcy5ydW4oKTtcbiAgICByZXR1cm4gdGhpcy5kcml2ZXIuZXZhbHVhdGUoZm4sIC4uLmFyZ3MpO1xuICB9XG5cbiAgd2FpdChtczogbnVtYmVyKTogRWxlY3Ryb2xpemVyPFQ+XG4gIHdhaXQoc2VsZWN0b3I6IHN0cmluZywgZGVsYXk/OiBudW1iZXIpOiBFbGVjdHJvbGl6ZXI8VD5cbiAgd2FpdDxSLCBLIGV4dGVuZHMgYW55W10+KGZuOiAoLi4uYXJnczogUHVzaDxLLCBSPikgPT4gYm9vbGVhbiB8IFByb21pc2U8Ym9vbGVhbj4gLCAuLi5hcmdzOiBLKTogRWxlY3Ryb2xpemVyPFQ+XG4gIHdhaXQoKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICAvL0B0cy1pZ25vcmVcbiAgICB0aGlzLl9xdWV1ZSgoKSA9PiB0aGlzLmRyaXZlci53YWl0LmFwcGx5KHRoaXMuZHJpdmVyLCBhcmd1bWVudHMpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGhlYWRlcihoZWFkZXI6IHN0cmluZywgdmFsdWU6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBhdXRoZW50aWNhdGlvbih1c2VybmFtZTogc3RyaW5nLCBwYXNzd29yZDogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLl9xdWV1ZSh0aGlzLmRyaXZlci5hdXRoZW50aWNhdGlvbi5iaW5kKHRoaXMuZHJpdmVyLCB1c2VybmFtZSwgcGFzc3dvcmQpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHVzZXJhZ2VudCh1c2VyYWdlbnQ6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIudXNlcmFnZW50LmJpbmQodGhpcy5kcml2ZXIsIHVzZXJhZ2VudCkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYXN5bmMgcnVuKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGZvcihsZXQgYmxvY2sgb2YgdGhpcy5xdWV1ZSl7XG4gICAgICBhd2FpdCBibG9jaygpO1xuICAgIH1cblxuICAgIHRoaXMucXVldWUgPSBbXTtcbiAgfVxuXG4gIGFzeW5jIGVuZCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLnJ1bigpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEVsZWN0cm9saXplcjsiXX0=