"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.Electrolizer = exports.ElectrolizerType = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _electron = require("electron");

var _drivers = require("./drivers");

var ElectrolizerType;
exports.ElectrolizerType = ElectrolizerType;

(function (ElectrolizerType) {
  ElectrolizerType["webview"] = "webview";
  ElectrolizerType["browserView"] = "browserView";
  ElectrolizerType["browserWindow"] = "browserWindow";
})(ElectrolizerType || (exports.ElectrolizerType = ElectrolizerType = {}));

class Electrolizer {
  constructor(bus) {
    this.bus = bus;
    (0, _defineProperty2.default)(this, "interactionReady", false);
    (0, _defineProperty2.default)(this, "queue", []);
    (0, _defineProperty2.default)(this, "driver", void 0);
    (0, _defineProperty2.default)(this, "cookies", {
      clearAll: () => {
        this._queue(() => this.driver.cookies.clearAll());

        return this;
      },
      get: arg => {
        return this.driver.cookies.get(arg);
      },
      set: (name, value) => {
        //@ts-ignore
        this._queue(() => this.driver.cookies.set(name, value));

        return this;
      },
      clear: name => {
        this._queue(() => this.driver.cookies.clear(name));

        return this;
      }
    });
    this.setupDriver();
  }

  setupDriver() {
    switch (this.busType) {
      case ElectrolizerType.webview:
        this.driver = new _drivers.WebviewTagDriver(this.bus);
        break;

      case ElectrolizerType.browserWindow:
        this.driver = new _drivers.BrowserWindowDriver(this.bus);
        break;

      case ElectrolizerType.browserView:
        this.driver = new _drivers.BrowserViewDriver(this.bus);
        break;
    }
  }

  get busType() {
    try {
      var instanceOfTest = this.bus instanceof _electron.BrowserView;
    } catch (error) {
      return ElectrolizerType.webview;
    }

    if (this.bus instanceof _electron.BrowserView) {
      return ElectrolizerType.browserView;
    }

    if (this.bus instanceof _electron.BrowserWindow) {
      return ElectrolizerType.browserWindow;
    }

    return ElectrolizerType.webview;
  }

  _queue(fn) {
    this.queue.push(fn);
  }

  goto(url, headers) {
    this._queue(this.driver.goto.bind(this.driver, url, headers));

    return this;
  }

  back() {
    this._queue(this.driver.back.bind(this.driver));

    return this;
  }

  forward() {
    this._queue(this.driver.forward.bind(this.driver));

    return this;
  }

  refresh() {
    this._queue(this.driver.refresh.bind(this.driver));

    return this;
  }

  click(selector) {
    this._queue(this.driver.click.bind(this.driver, selector));

    return this;
  }

  mousedown(selector) {
    this._queue(this.driver.mousedown.bind(this.driver, selector));

    return this;
  }

  mouseup(selector) {
    this._queue(this.driver.mouseup.bind(this.driver, selector));

    return this;
  }

  mouseover(selector) {
    this._queue(this.driver.mouseover.bind(this.driver, selector));

    return this;
  }

  mouseout(selector) {
    this._queue(this.driver.mouseout.bind(this.driver, selector));

    return this;
  }

  type(selector, text) {
    this._queue(this.driver.type.bind(this.driver, selector, text));

    return this;
  }

  insert(selector, text) {
    this._queue(this.driver.insert.bind(this.driver, selector, text));

    return this;
  }

  check(selector) {
    this._queue(this.driver.check.bind(this.driver, selector));

    return this;
  }

  uncheck(selector) {
    this._queue(this.driver.uncheck.bind(this.driver, selector));

    return this;
  }

  select(selector, option) {
    this._queue(this.driver.select.bind(this.driver, selector, option));

    return this;
  }

  scrollTo(top, left) {
    this._queue(this.driver.scrollTo.bind(this.driver, top, left));

    return this;
  }

  viewport(width, height) {
    this._queue(this.driver.viewport.bind(this.driver, width, height));

    return this;
  }

  inject(type, file) {
    this._queue(this.driver.inject.bind(this.driver, type, file));

    return this;
  }

  exists(selector) {
    var _this = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this.run();
      return yield _this.driver.exists(selector);
    })();
  }

  html() {
    var _this2 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this2.run();
      return yield _this2.driver.html();
    })();
  }

  evaluate(fn) {
    var _arguments = arguments,
        _this3 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      for (var _len = _arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
        args[_key - 1] = _arguments[_key];
      }

      yield _this3.run();
      return _this3.driver.evaluate_now(fn, ...args);
    })();
  }

  wait() {
    //@ts-ignore
    this._queue(() => this.driver.wait.apply(this.driver, arguments));

    return this;
  }

  header(header, value) {
    return this;
  }

  authentication(username, password) {
    this._queue(this.driver.authentication.bind(this.driver, username, password));

    return this;
  }

  run() {
    var _this4 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      for (var block of _this4.queue) {
        try {
          yield block();
        } catch (error) {
          console.log("ERROR", error, block);
        }
      }

      _this4.queue = [];
    })();
  }

}

exports.Electrolizer = Electrolizer;
var _default = Electrolizer;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lbGVjdHJvbGl6ZXIuY2xhc3MudHMiXSwibmFtZXMiOlsiRWxlY3Ryb2xpemVyVHlwZSIsIkVsZWN0cm9saXplciIsImNvbnN0cnVjdG9yIiwiYnVzIiwiY2xlYXJBbGwiLCJfcXVldWUiLCJkcml2ZXIiLCJjb29raWVzIiwiZ2V0IiwiYXJnIiwic2V0IiwibmFtZSIsInZhbHVlIiwiY2xlYXIiLCJzZXR1cERyaXZlciIsImJ1c1R5cGUiLCJ3ZWJ2aWV3IiwiV2Vidmlld1RhZ0RyaXZlciIsImJyb3dzZXJXaW5kb3ciLCJCcm93c2VyV2luZG93RHJpdmVyIiwiYnJvd3NlclZpZXciLCJCcm93c2VyVmlld0RyaXZlciIsImluc3RhbmNlT2ZUZXN0IiwiQnJvd3NlclZpZXciLCJlcnJvciIsIkJyb3dzZXJXaW5kb3ciLCJmbiIsInF1ZXVlIiwicHVzaCIsImdvdG8iLCJ1cmwiLCJoZWFkZXJzIiwiYmluZCIsImJhY2siLCJmb3J3YXJkIiwicmVmcmVzaCIsImNsaWNrIiwic2VsZWN0b3IiLCJtb3VzZWRvd24iLCJtb3VzZXVwIiwibW91c2VvdmVyIiwibW91c2VvdXQiLCJ0eXBlIiwidGV4dCIsImluc2VydCIsImNoZWNrIiwidW5jaGVjayIsInNlbGVjdCIsIm9wdGlvbiIsInNjcm9sbFRvIiwidG9wIiwibGVmdCIsInZpZXdwb3J0Iiwid2lkdGgiLCJoZWlnaHQiLCJpbmplY3QiLCJmaWxlIiwiZXhpc3RzIiwicnVuIiwiaHRtbCIsImV2YWx1YXRlIiwiYXJncyIsImV2YWx1YXRlX25vdyIsIndhaXQiLCJhcHBseSIsImFyZ3VtZW50cyIsImhlYWRlciIsImF1dGhlbnRpY2F0aW9uIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsImJsb2NrIiwiY29uc29sZSIsImxvZyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBOztBQUdBOztJQUlZQSxnQjs7O1dBQUFBLGdCO0FBQUFBLEVBQUFBLGdCO0FBQUFBLEVBQUFBLGdCO0FBQUFBLEVBQUFB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dk15SDs7O2VBME03RzFCLFkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCcm93c2VyVmlldywgQnJvd3NlcldpbmRvdywgV2Vidmlld1RhZywgV2ViQ29udGVudHMgfSBmcm9tICdlbGVjdHJvbic7XG5pbXBvcnQgeyBPcGVyYXRvckZ1bmN0aW9ucyB9IGZyb20gJy4vb3BlcmF0b3ItZnVuY3Rpb25zLmludGVyZmFjZSc7XG5pbXBvcnQgeyBzZXJpZXMgfSBmcm9tICdhc3luYyc7XG5pbXBvcnQgeyBXZWJ2aWV3VGFnRHJpdmVyLCBCcm93c2VyVmlld0RyaXZlciwgQnJvd3NlcldpbmRvd0RyaXZlciB9IGZyb20gJy4vZHJpdmVycyc7XG5pbXBvcnQgeyBQdXNoIH0gZnJvbSAnLi9ldmFsdWF0ZS1mdW5jdGlvbi50eXBlJztcbmltcG9ydCB7IENvb2tpZXMgfSBmcm9tICcuL2RyaXZlcnMvY29va2llcy5pbnRlcmZhY2UnO1xuXG5leHBvcnQgZW51bSBFbGVjdHJvbGl6ZXJUeXBlIHtcbiAgd2VidmlldyA9ICd3ZWJ2aWV3JyxcbiAgYnJvd3NlclZpZXcgPSAnYnJvd3NlclZpZXcnLFxuICBicm93c2VyV2luZG93ID0gJ2Jyb3dzZXJXaW5kb3cnXG59XG5cblxuZXhwb3J0IGNsYXNzIEVsZWN0cm9saXplcjxUIGV4dGVuZHMgV2Vidmlld1RhZyB8IEJyb3dzZXJWaWV3IHwgQnJvd3NlcldpbmRvdz4gaW1wbGVtZW50cyBPcGVyYXRvckZ1bmN0aW9uczxFbGVjdHJvbGl6ZXI8VD4+IHtcblxuICBpbnRlcmFjdGlvblJlYWR5OiBib29sZWFuID0gZmFsc2U7XG5cbiAgcXVldWU6ICgoKSA9PiBQcm9taXNlPGFueT4pW10gPSBbXTtcblxuICBkcml2ZXIhOiBXZWJ2aWV3VGFnRHJpdmVyIHwgQnJvd3NlcldpbmRvd0RyaXZlciB8IEJyb3dzZXJWaWV3RHJpdmVyO1xuXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBidXM6IFQpe1xuICAgIHRoaXMuc2V0dXBEcml2ZXIoKTtcbiAgfVxuXG4gIGNvb2tpZXM6IENvb2tpZXM8RWxlY3Ryb2xpemVyPFQ+PiA9IHtcbiAgICBjbGVhckFsbDogKCkgPT4geyBcbiAgICAgIHRoaXMuX3F1ZXVlKCAoKSA9PiB0aGlzLmRyaXZlci5jb29raWVzLmNsZWFyQWxsKCkgKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgZ2V0OiAoYXJnOiBhbnkpID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmRyaXZlci5jb29raWVzLmdldChhcmcpXG4gICAgfSxcbiAgICBzZXQ6IChuYW1lOiBzdHJpbmcgfCBFbGVjdHJvbi5Db29raWUsIHZhbHVlPzogc3RyaW5nKSA9PiB7XG4gICAgICAvL0B0cy1pZ25vcmVcbiAgICAgIHRoaXMuX3F1ZXVlKCgpID0+IHRoaXMuZHJpdmVyLmNvb2tpZXMuc2V0KG5hbWUsIHZhbHVlKSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIGNsZWFyOiAobmFtZT86IHN0cmluZykgPT4ge1xuICAgICAgdGhpcy5fcXVldWUoKCkgPT4gdGhpcy5kcml2ZXIuY29va2llcy5jbGVhcihuYW1lKSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICB9XG5cbiAgXG4gIHByaXZhdGUgc2V0dXBEcml2ZXIoKXtcbiAgICBzd2l0Y2godGhpcy5idXNUeXBlKXtcbiAgICAgIGNhc2UgRWxlY3Ryb2xpemVyVHlwZS53ZWJ2aWV3OlxuICAgICAgICB0aGlzLmRyaXZlciA9IG5ldyBXZWJ2aWV3VGFnRHJpdmVyKHRoaXMuYnVzIGFzIFdlYnZpZXdUYWcpO1xuICAgICAgYnJlYWs7XG4gICAgICBcbiAgICAgIGNhc2UgRWxlY3Ryb2xpemVyVHlwZS5icm93c2VyV2luZG93OlxuICAgICAgICB0aGlzLmRyaXZlciA9IG5ldyBCcm93c2VyV2luZG93RHJpdmVyKHRoaXMuYnVzIGFzIEJyb3dzZXJXaW5kb3cpO1xuICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgRWxlY3Ryb2xpemVyVHlwZS5icm93c2VyVmlldzpcbiAgICAgICAgdGhpcy5kcml2ZXIgPSBuZXcgQnJvd3NlclZpZXdEcml2ZXIodGhpcy5idXMgYXMgQnJvd3NlclZpZXcpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBcbiAgZ2V0IGJ1c1R5cGUoKTogRWxlY3Ryb2xpemVyVHlwZSB7XG4gICAgdHJ5IHtcbiAgICAgIGxldCBpbnN0YW5jZU9mVGVzdCA9IHRoaXMuYnVzIGluc3RhbmNlb2YgQnJvd3NlclZpZXc7XG4gICAgfSBjYXRjaChlcnJvcil7XG4gICAgICByZXR1cm4gRWxlY3Ryb2xpemVyVHlwZS53ZWJ2aWV3O1xuICAgIH1cblxuICAgIGlmKHRoaXMuYnVzIGluc3RhbmNlb2YgQnJvd3NlclZpZXcpe1xuICAgICAgcmV0dXJuIEVsZWN0cm9saXplclR5cGUuYnJvd3NlclZpZXc7XG4gICAgfVxuXG4gICAgaWYodGhpcy5idXMgaW5zdGFuY2VvZiBCcm93c2VyV2luZG93KXtcbiAgICAgIHJldHVybiBFbGVjdHJvbGl6ZXJUeXBlLmJyb3dzZXJXaW5kb3c7XG4gICAgfVxuXG4gICAgcmV0dXJuIEVsZWN0cm9saXplclR5cGUud2VidmlldztcbiAgfVxuICBcbiAgcHJpdmF0ZSBfcXVldWUoZm46ICgpID0+IFByb21pc2U8YW55Pil7XG4gICAgdGhpcy5xdWV1ZS5wdXNoKGZuKTtcbiAgfVxuXG4gIGdvdG8odXJsOiBzdHJpbmcsIGhlYWRlcnM/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLl9xdWV1ZSh0aGlzLmRyaXZlci5nb3RvLmJpbmQodGhpcy5kcml2ZXIsIHVybCwgaGVhZGVycykpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYmFjaygpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMuX3F1ZXVlKHRoaXMuZHJpdmVyLmJhY2suYmluZCh0aGlzLmRyaXZlcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZm9yd2FyZCgpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMuX3F1ZXVlKHRoaXMuZHJpdmVyLmZvcndhcmQuYmluZCh0aGlzLmRyaXZlcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgcmVmcmVzaCgpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMuX3F1ZXVlKHRoaXMuZHJpdmVyLnJlZnJlc2guYmluZCh0aGlzLmRyaXZlcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgY2xpY2soc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIuY2xpY2suYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG1vdXNlZG93bihzZWxlY3Rvcjogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLl9xdWV1ZSh0aGlzLmRyaXZlci5tb3VzZWRvd24uYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG1vdXNldXAoc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIubW91c2V1cC5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgbW91c2VvdmVyKHNlbGVjdG9yOiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMuX3F1ZXVlKHRoaXMuZHJpdmVyLm1vdXNlb3Zlci5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgbW91c2VvdXQoc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIubW91c2VvdXQuYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHR5cGUoc2VsZWN0b3I6IHN0cmluZywgdGV4dD86IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIudHlwZS5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvciwgdGV4dCkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgaW5zZXJ0KHNlbGVjdG9yOiBzdHJpbmcsIHRleHQ/OiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMuX3F1ZXVlKHRoaXMuZHJpdmVyLmluc2VydC5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvciwgdGV4dCkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgY2hlY2soc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIuY2hlY2suYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHVuY2hlY2soc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIudW5jaGVjay5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgc2VsZWN0KHNlbGVjdG9yOiBzdHJpbmcsIG9wdGlvbj86IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIuc2VsZWN0LmJpbmQodGhpcy5kcml2ZXIsIHNlbGVjdG9yLCBvcHRpb24pKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHNjcm9sbFRvKHRvcDogbnVtYmVyLCBsZWZ0OiBudW1iZXIpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMuX3F1ZXVlKHRoaXMuZHJpdmVyLnNjcm9sbFRvLmJpbmQodGhpcy5kcml2ZXIsIHRvcCwgbGVmdCkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgdmlld3BvcnQod2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMuX3F1ZXVlKHRoaXMuZHJpdmVyLnZpZXdwb3J0LmJpbmQodGhpcy5kcml2ZXIsIHdpZHRoLCBoZWlnaHQpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGluamVjdCh0eXBlOiAnanMnIHwgJ2NzcycsIGZpbGU6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIuaW5qZWN0LmJpbmQodGhpcy5kcml2ZXIsIHR5cGUsIGZpbGUpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGFzeW5jIGV4aXN0cyhzZWxlY3Rvcjogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgYXdhaXQgdGhpcy5ydW4oKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5kcml2ZXIuZXhpc3RzKHNlbGVjdG9yKTtcbiAgfVxuXG4gIGFzeW5jIGh0bWwoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBhd2FpdCB0aGlzLnJ1bigpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmRyaXZlci5odG1sKCk7XG4gIH1cblxuICBhc3luYyBldmFsdWF0ZTxULCBLIGV4dGVuZHMgYW55W10sIFI+KGZuOiAoLi4uYXJnczogUHVzaDxLLCBUPikgPT4gUiwgLi4uYXJnczogSyk6IFByb21pc2U8Uj4ge1xuICAgIGF3YWl0IHRoaXMucnVuKCk7XG4gICAgcmV0dXJuIHRoaXMuZHJpdmVyLmV2YWx1YXRlX25vdyhmbiwgLi4uYXJncyk7XG4gIH1cblxuICB3YWl0KG1zOiBudW1iZXIpOiBFbGVjdHJvbGl6ZXI8VD5cbiAgd2FpdChzZWxlY3Rvcjogc3RyaW5nLCBkZWxheT86IG51bWJlcik6IEVsZWN0cm9saXplcjxUPlxuICB3YWl0PFIsIEsgZXh0ZW5kcyBhbnlbXT4oZm46ICguLi5hcmdzOiBQdXNoPEssIFI+KSA9PiBib29sZWFuIHwgUHJvbWlzZTxib29sZWFuPiAsIC4uLmFyZ3M6IEspOiBFbGVjdHJvbGl6ZXI8VD5cbiAgd2FpdCgpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIC8vQHRzLWlnbm9yZVxuICAgIHRoaXMuX3F1ZXVlKCgpID0+IHRoaXMuZHJpdmVyLndhaXQuYXBwbHkodGhpcy5kcml2ZXIsIGFyZ3VtZW50cykpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgaGVhZGVyKGhlYWRlcjogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGF1dGhlbnRpY2F0aW9uKHVzZXJuYW1lOiBzdHJpbmcsIHBhc3N3b3JkOiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMuX3F1ZXVlKHRoaXMuZHJpdmVyLmF1dGhlbnRpY2F0aW9uLmJpbmQodGhpcy5kcml2ZXIsIHVzZXJuYW1lLCBwYXNzd29yZCkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYXN5bmMgcnVuKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGZvcihsZXQgYmxvY2sgb2YgdGhpcy5xdWV1ZSl7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBibG9jaygpO1xuICAgICAgfSBjYXRjaChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmxvZyhcIkVSUk9SXCIsIGVycm9yLCBibG9jayk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5xdWV1ZSA9IFtdO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEVsZWN0cm9saXplcjsiXX0=