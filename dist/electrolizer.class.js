"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.Electrolizer = exports.ElectrolizerType = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _drivers = require("./drivers");

var ElectrolizerType;
exports.ElectrolizerType = ElectrolizerType;

(function (ElectrolizerType) {
  ElectrolizerType["webview"] = "webview";
  ElectrolizerType["browserView"] = "browserView";
  ElectrolizerType["browserWindow"] = "browserWindow";
})(ElectrolizerType || (exports.ElectrolizerType = ElectrolizerType = {}));

class Electrolizer {
  constructor(bus) {
    this.bus = bus;
    (0, _defineProperty2.default)(this, "_queue", []);
    (0, _defineProperty2.default)(this, "driver", void 0);
    (0, _defineProperty2.default)(this, "cookies", {
      clearAll: () => {
        this.queue(() => this.driver.cookies.clearAll());
        return this;
      },
      get: arg => {
        return this.driver.cookies.get(arg);
      },
      set: (name, value) => {
        //@ts-ignore
        this.queue(() => this.driver.cookies.set(name, value));
        return this;
      },
      clear: name => {
        this.queue(() => this.driver.cookies.clear(name));
        return this;
      }
    });
    this.setupDriver();
  }

  setupDriver() {
    switch (this.busType) {
      case ElectrolizerType.webview:
        this.driver = new _drivers.WebviewTagDriver(this.bus, this.busType);
        break;

      case ElectrolizerType.browserWindow:
        this.driver = new _drivers.BrowserWindowDriver(this.bus, this.busType);
        break;

      case ElectrolizerType.browserView:
        this.driver = new _drivers.BrowserViewDriver(this.bus, this.busType);
        break;
    }
  }

  get busType() {
    //@ts-ignore
    if (this.bus.hasOwnProperty('webContents') || !!this.bus.webContents || typeof this.bus.webContents !== "undefined") {
      return ElectrolizerType.browserWindow;
    }

    return ElectrolizerType.webview;
  }

  queue(fn) {
    this._queue.push(fn);
  }

  goto(url, headers) {
    this.queue(this.driver.goto.bind(this.driver, url, headers));
    return this;
  }

  back() {
    this.queue(this.driver.back.bind(this.driver));
    return this;
  }

  forward() {
    this.queue(this.driver.forward.bind(this.driver));
    return this;
  }

  refresh() {
    this.queue(this.driver.refresh.bind(this.driver));
    return this;
  }

  click(selector) {
    this.queue(this.driver.click.bind(this.driver, selector));
    return this;
  }

  mousedown(selector) {
    this.queue(this.driver.mousedown.bind(this.driver, selector));
    return this;
  }

  mouseup(selector) {
    this.queue(this.driver.mouseup.bind(this.driver, selector));
    return this;
  }

  mouseover(selector) {
    this.queue(this.driver.mouseover.bind(this.driver, selector));
    return this;
  }

  mouseout(selector) {
    this.queue(this.driver.mouseout.bind(this.driver, selector));
    return this;
  }

  focus(selector) {
    this.queue(this.driver.focus.bind(this.driver, selector));
    return this;
  }

  blur(selector) {
    this.queue(this.driver.focus.bind(this.driver, selector));
    return this;
  }

  type(selector, text) {
    this.queue(this.driver.type.bind(this.driver, selector, text));
    return this;
  }

  insert(selector, text) {
    this.queue(this.driver.insert.bind(this.driver, selector, text));
    return this;
  }

  check(selector) {
    this.queue(this.driver.check.bind(this.driver, selector));
    return this;
  }

  uncheck(selector) {
    this.queue(this.driver.uncheck.bind(this.driver, selector));
    return this;
  }

  select(selector, option) {
    this.queue(this.driver.select.bind(this.driver, selector, option));
    return this;
  }

  scrollTo(top, left) {
    this.queue(this.driver.scrollTo.bind(this.driver, top, left));
    return this;
  }

  viewport(width, height) {
    this.queue(this.driver.viewport.bind(this.driver, width, height));
    return this;
  }

  inject(type, file) {
    this.queue(this.driver.inject.bind(this.driver, type, file));
    return this;
  }

  exists(selector) {
    var _this = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this.run();
      return yield _this.driver.exists(selector);
    })();
  }

  html() {
    var _this2 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this2.run();
      return yield _this2.driver.html();
    })();
  }

  evaluate(fn) {
    var _arguments = arguments,
        _this3 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      for (var _len = _arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
        args[_key - 1] = _arguments[_key];
      }

      yield _this3.run();
      return _this3.driver.evaluate(fn, ...args);
    })();
  }

  url() {
    var _this4 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this4.run();
      return yield _this4.driver.url();
    })();
  }

  path() {
    var _this5 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this5.run();
      return yield _this5.driver.path();
    })();
  }

  title() {
    var _this6 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this6.run();
      return yield _this6.driver.title();
    })();
  }

  pdf(options) {
    var _this7 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this7.run();
      return yield _this7.driver.pdf(options);
    })();
  }

  screenshot(rect, options) {
    var _this8 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this8.run();
      return yield _this8.driver.screenshot(rect, options);
    })();
  }

  wait() {
    //@ts-ignore
    this.queue(() => this.driver.wait.apply(this.driver, arguments));
    return this;
  }

  header(header, value) {
    this.queue(this.driver.header.bind(this.driver, header, value));
    return this;
  }

  authentication(username, password) {
    this.queue(this.driver.authentication.bind(this.driver, username, password));
    return this;
  }

  useragent(useragent) {
    this.queue(this.driver.useragent.bind(this.driver, useragent));
    return this;
  }

  run() {
    var _this9 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      for (var block of _this9._queue) {
        yield block();
      }

      _this9._queue = [];
    })();
  }

  end() {
    var _this10 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _this10.run();
    })();
  }

}

exports.Electrolizer = Electrolizer;
var _default = Electrolizer;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lbGVjdHJvbGl6ZXIuY2xhc3MudHMiXSwibmFtZXMiOlsiRWxlY3Ryb2xpemVyVHlwZSIsIkVsZWN0cm9saXplciIsImNvbnN0cnVjdG9yIiwiYnVzIiwiY2xlYXJBbGwiLCJxdWV1ZSIsImRyaXZlciIsImNvb2tpZXMiLCJnZXQiLCJhcmciLCJzZXQiLCJuYW1lIiwidmFsdWUiLCJjbGVhciIsInNldHVwRHJpdmVyIiwiYnVzVHlwZSIsIndlYnZpZXciLCJXZWJ2aWV3VGFnRHJpdmVyIiwiYnJvd3NlcldpbmRvdyIsIkJyb3dzZXJXaW5kb3dEcml2ZXIiLCJicm93c2VyVmlldyIsIkJyb3dzZXJWaWV3RHJpdmVyIiwiaGFzT3duUHJvcGVydHkiLCJ3ZWJDb250ZW50cyIsImZuIiwiX3F1ZXVlIiwicHVzaCIsImdvdG8iLCJ1cmwiLCJoZWFkZXJzIiwiYmluZCIsImJhY2siLCJmb3J3YXJkIiwicmVmcmVzaCIsImNsaWNrIiwic2VsZWN0b3IiLCJtb3VzZWRvd24iLCJtb3VzZXVwIiwibW91c2VvdmVyIiwibW91c2VvdXQiLCJmb2N1cyIsImJsdXIiLCJ0eXBlIiwidGV4dCIsImluc2VydCIsImNoZWNrIiwidW5jaGVjayIsInNlbGVjdCIsIm9wdGlvbiIsInNjcm9sbFRvIiwidG9wIiwibGVmdCIsInZpZXdwb3J0Iiwid2lkdGgiLCJoZWlnaHQiLCJpbmplY3QiLCJmaWxlIiwiZXhpc3RzIiwicnVuIiwiaHRtbCIsImV2YWx1YXRlIiwiYXJncyIsInBhdGgiLCJ0aXRsZSIsInBkZiIsIm9wdGlvbnMiLCJzY3JlZW5zaG90IiwicmVjdCIsIndhaXQiLCJhcHBseSIsImFyZ3VtZW50cyIsImhlYWRlciIsImF1dGhlbnRpY2F0aW9uIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsInVzZXJhZ2VudCIsImJsb2NrIiwiZW5kIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBRUE7O0lBSVlBLGdCOzs7V0FBQUEsZ0I7QUFBQUEsRUFBQUEsZ0I7QUFB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Q0EsV0FBTyxJQUFQO0FBQ0Q7O0FBRUtqQixFQUFBQSxHQUFOLEdBQTJCO0FBQUE7O0FBQUE7QUFDekIsV0FBSSxJQUFJa0IsS0FBUixJQUFpQixNQUFJLENBQUNuRCxNQUF0QixFQUE2QjtBQUMzQixjQUFNbUQsS0FBSyxFQUFYO0FBQ0Q7O0FBRUQsTUFBQSxNQUFJLENBQUNuRCxNQUFMLEdBQWMsRUFBZDtBQUx5QjtBQU0xQjs7QUFFS29ELEVBQUFBLEdBQU4sR0FBMkI7QUFBQTs7QUFBQTtBQUN6QixNQUFBLE9BQUksQ0FBQ25CLEdBQUw7QUFEeUI7QUFFMUI7O0FBcE9tSjs7O2VBdU92SXpELFkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFbGVjdHJvblNoaW1zIH0gZnJvbSAnLi9zaGltcy9lbGVjdHJvbi1zaGltcyc7XG5pbXBvcnQgeyBPcGVyYXRvckZ1bmN0aW9ucyB9IGZyb20gJy4vb3BlcmF0b3ItZnVuY3Rpb25zLmludGVyZmFjZSc7XG5pbXBvcnQgeyBXZWJ2aWV3VGFnRHJpdmVyLCBCcm93c2VyVmlld0RyaXZlciwgQnJvd3NlcldpbmRvd0RyaXZlciB9IGZyb20gJy4vZHJpdmVycyc7XG5pbXBvcnQgeyBQdXNoIH0gZnJvbSAnLi9ldmFsdWF0ZS1mdW5jdGlvbi50eXBlJztcbmltcG9ydCB7IENvb2tpZXMgfSBmcm9tICcuL2RyaXZlcnMvY29va2llcy5pbnRlcmZhY2UnO1xuXG5leHBvcnQgZW51bSBFbGVjdHJvbGl6ZXJUeXBlIHtcbiAgd2VidmlldyA9ICd3ZWJ2aWV3JyxcbiAgYnJvd3NlclZpZXcgPSAnYnJvd3NlclZpZXcnLFxuICBicm93c2VyV2luZG93ID0gJ2Jyb3dzZXJXaW5kb3cnXG59XG5cblxuZXhwb3J0IGNsYXNzIEVsZWN0cm9saXplcjxUIGV4dGVuZHMgRWxlY3Ryb25TaGltcy5XZWJ2aWV3VGFnTGlrZSB8IEVsZWN0cm9uU2hpbXMuQnJvd3NlcldpbmRvd1ZpZXdMaWtlPiBpbXBsZW1lbnRzIE9wZXJhdG9yRnVuY3Rpb25zPEVsZWN0cm9saXplcjxUPj4ge1xuXG4gIHByaXZhdGUgX3F1ZXVlOiAoKCkgPT4gUHJvbWlzZTxhbnk+KVtdID0gW107XG5cbiAgcHJpdmF0ZSBkcml2ZXIhOiBXZWJ2aWV3VGFnRHJpdmVyIHwgQnJvd3NlcldpbmRvd0RyaXZlciB8IEJyb3dzZXJWaWV3RHJpdmVyO1xuXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBidXM6IFQpe1xuICAgIHRoaXMuc2V0dXBEcml2ZXIoKTtcbiAgfVxuXG4gIGNvb2tpZXM6IENvb2tpZXM8RWxlY3Ryb2xpemVyPFQ+PiA9IHtcbiAgICBjbGVhckFsbDogKCkgPT4geyBcbiAgICAgIHRoaXMucXVldWUoICgpID0+IHRoaXMuZHJpdmVyLmNvb2tpZXMuY2xlYXJBbGwoKSApO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBnZXQ6IChhcmc/OiBhbnkpID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmRyaXZlci5jb29raWVzLmdldChhcmcpXG4gICAgfSxcbiAgICBzZXQ6IChuYW1lOiBzdHJpbmcgfCBFbGVjdHJvbi5Db29raWUsIHZhbHVlPzogc3RyaW5nKSA9PiB7XG4gICAgICAvL0B0cy1pZ25vcmVcbiAgICAgIHRoaXMucXVldWUoKCkgPT4gdGhpcy5kcml2ZXIuY29va2llcy5zZXQobmFtZSwgdmFsdWUpKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgY2xlYXI6IChuYW1lPzogc3RyaW5nKSA9PiB7XG4gICAgICB0aGlzLnF1ZXVlKCgpID0+IHRoaXMuZHJpdmVyLmNvb2tpZXMuY2xlYXIobmFtZSkpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgfVxuXG4gIFxuICBwcml2YXRlIHNldHVwRHJpdmVyKCl7XG4gICAgc3dpdGNoKHRoaXMuYnVzVHlwZSl7XG4gICAgICBjYXNlIEVsZWN0cm9saXplclR5cGUud2VidmlldzpcbiAgICAgICAgdGhpcy5kcml2ZXIgPSBuZXcgV2Vidmlld1RhZ0RyaXZlcih0aGlzLmJ1cyBhcyBFbGVjdHJvblNoaW1zLldlYnZpZXdUYWdMaWtlLCB0aGlzLmJ1c1R5cGUpO1xuICAgICAgYnJlYWs7XG4gICAgICBcbiAgICAgIGNhc2UgRWxlY3Ryb2xpemVyVHlwZS5icm93c2VyV2luZG93OlxuICAgICAgICB0aGlzLmRyaXZlciA9IG5ldyBCcm93c2VyV2luZG93RHJpdmVyKHRoaXMuYnVzIGFzIEVsZWN0cm9uU2hpbXMuQnJvd3NlcldpbmRvd1ZpZXdMaWtlLCB0aGlzLmJ1c1R5cGUpO1xuICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgRWxlY3Ryb2xpemVyVHlwZS5icm93c2VyVmlldzpcbiAgICAgICAgdGhpcy5kcml2ZXIgPSBuZXcgQnJvd3NlclZpZXdEcml2ZXIodGhpcy5idXMgYXMgRWxlY3Ryb25TaGltcy5Ccm93c2VyV2luZG93Vmlld0xpa2UsIHRoaXMuYnVzVHlwZSk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIFxuICBnZXQgYnVzVHlwZSgpOiBFbGVjdHJvbGl6ZXJUeXBlIHtcbiAgICAvL0B0cy1pZ25vcmVcbiAgICBpZih0aGlzLmJ1cy5oYXNPd25Qcm9wZXJ0eSgnd2ViQ29udGVudHMnKSB8fCAhIXRoaXMuYnVzLndlYkNvbnRlbnRzIHx8IHR5cGVvZiB0aGlzLmJ1cy53ZWJDb250ZW50cyAhPT0gXCJ1bmRlZmluZWRcIil7XG4gICAgICByZXR1cm4gRWxlY3Ryb2xpemVyVHlwZS5icm93c2VyV2luZG93O1xuICAgIH1cbiAgICByZXR1cm4gRWxlY3Ryb2xpemVyVHlwZS53ZWJ2aWV3O1xuICB9XG4gIFxuICBwcml2YXRlIHF1ZXVlKGZuOiAoKSA9PiBQcm9taXNlPGFueT4pe1xuICAgIHRoaXMuX3F1ZXVlLnB1c2goZm4pO1xuICB9XG5cbiAgZ290byh1cmw6IHN0cmluZywgaGVhZGVycz86IFJlY29yZDxzdHJpbmcsIHN0cmluZz4pOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIuZ290by5iaW5kKHRoaXMuZHJpdmVyLCB1cmwsIGhlYWRlcnMpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGJhY2soKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLmJhY2suYmluZCh0aGlzLmRyaXZlcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZm9yd2FyZCgpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIuZm9yd2FyZC5iaW5kKHRoaXMuZHJpdmVyKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICByZWZyZXNoKCk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci5yZWZyZXNoLmJpbmQodGhpcy5kcml2ZXIpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGNsaWNrKHNlbGVjdG9yOiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIuY2xpY2suYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG1vdXNlZG93bihzZWxlY3Rvcjogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLm1vdXNlZG93bi5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgbW91c2V1cChzZWxlY3Rvcjogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLm1vdXNldXAuYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG1vdXNlb3ZlcihzZWxlY3Rvcjogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLm1vdXNlb3Zlci5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgbW91c2VvdXQoc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci5tb3VzZW91dC5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZm9jdXMoc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci5mb2N1cy5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYmx1cihzZWxlY3Rvcjogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLmZvY3VzLmJpbmQodGhpcy5kcml2ZXIsIHNlbGVjdG9yKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICB0eXBlKHNlbGVjdG9yOiBzdHJpbmcsIHRleHQ/OiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIudHlwZS5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvciwgdGV4dCkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgaW5zZXJ0KHNlbGVjdG9yOiBzdHJpbmcsIHRleHQ/OiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIuaW5zZXJ0LmJpbmQodGhpcy5kcml2ZXIsIHNlbGVjdG9yLCB0ZXh0KSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBjaGVjayhzZWxlY3Rvcjogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLmNoZWNrLmJpbmQodGhpcy5kcml2ZXIsIHNlbGVjdG9yKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICB1bmNoZWNrKHNlbGVjdG9yOiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIudW5jaGVjay5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgc2VsZWN0KHNlbGVjdG9yOiBzdHJpbmcsIG9wdGlvbj86IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci5zZWxlY3QuYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IsIG9wdGlvbikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgc2Nyb2xsVG8odG9wOiBudW1iZXIsIGxlZnQ6IG51bWJlcik6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci5zY3JvbGxUby5iaW5kKHRoaXMuZHJpdmVyLCB0b3AsIGxlZnQpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHZpZXdwb3J0KHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLnZpZXdwb3J0LmJpbmQodGhpcy5kcml2ZXIsIHdpZHRoLCBoZWlnaHQpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGluamVjdCh0eXBlOiAnanMnIHwgJ2NzcycsIGZpbGU6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci5pbmplY3QuYmluZCh0aGlzLmRyaXZlciwgdHlwZSwgZmlsZSkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYXN5bmMgZXhpc3RzKHNlbGVjdG9yOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBhd2FpdCB0aGlzLnJ1bigpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmRyaXZlci5leGlzdHMoc2VsZWN0b3IpO1xuICB9XG5cbiAgYXN5bmMgaHRtbCgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGF3YWl0IHRoaXMucnVuKCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZHJpdmVyLmh0bWwoKTtcbiAgfVxuXG4gIGFzeW5jIGV2YWx1YXRlPFQsIEsgZXh0ZW5kcyBhbnlbXSwgUj4oZm46ICguLi5hcmdzOiBQdXNoPEssIFQ+KSA9PiBSLCAuLi5hcmdzOiBLKTogUHJvbWlzZTxSPiB7XG4gICAgYXdhaXQgdGhpcy5ydW4oKTtcbiAgICByZXR1cm4gdGhpcy5kcml2ZXIuZXZhbHVhdGUoZm4sIC4uLmFyZ3MpO1xuICB9XG5cbiAgYXN5bmMgdXJsKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgYXdhaXQgdGhpcy5ydW4oKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5kcml2ZXIudXJsKCk7XG4gIH1cblxuICBhc3luYyBwYXRoKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgYXdhaXQgdGhpcy5ydW4oKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5kcml2ZXIucGF0aCgpO1xuICB9XG5cbiAgYXN5bmMgdGl0bGUoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBhd2FpdCB0aGlzLnJ1bigpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmRyaXZlci50aXRsZSgpO1xuICB9XG5cbiAgYXN5bmMgcGRmKG9wdGlvbnM/OiBFbGVjdHJvbi5QcmludFRvUERGT3B0aW9ucyk6IFByb21pc2U8QnVmZmVyPiB7XG4gICAgYXdhaXQgdGhpcy5ydW4oKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5kcml2ZXIucGRmKG9wdGlvbnMpO1xuICB9XG5cbiAgYXN5bmMgc2NyZWVuc2hvdChyZWN0OiBFbGVjdHJvbi5SZWN0YW5nbGUsIG9wdGlvbnM6IEVsZWN0cm9uLlRvUE5HT3B0aW9ucyk6IFByb21pc2U8QnVmZmVyPiB7XG4gICAgYXdhaXQgdGhpcy5ydW4oKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5kcml2ZXIuc2NyZWVuc2hvdChyZWN0LCBvcHRpb25zKTtcbiAgfVxuXG4gIHdhaXQobXM6IG51bWJlcik6IEVsZWN0cm9saXplcjxUPlxuICB3YWl0KHNlbGVjdG9yOiBzdHJpbmcsIGRlbGF5PzogbnVtYmVyKTogRWxlY3Ryb2xpemVyPFQ+XG4gIHdhaXQ8UiwgSyBleHRlbmRzIGFueVtdPihmbjogKC4uLmFyZ3M6IFB1c2g8SywgUj4pID0+IGJvb2xlYW4gfCBQcm9taXNlPGJvb2xlYW4+ICwgLi4uYXJnczogSyk6IEVsZWN0cm9saXplcjxUPlxuICB3YWl0KCk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgLy9AdHMtaWdub3JlXG4gICAgdGhpcy5xdWV1ZSgoKSA9PiB0aGlzLmRyaXZlci53YWl0LmFwcGx5KHRoaXMuZHJpdmVyLCBhcmd1bWVudHMpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGhlYWRlcihoZWFkZXI/OiBzdHJpbmcsIHZhbHVlPzogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLmhlYWRlci5iaW5kKHRoaXMuZHJpdmVyLCBoZWFkZXIsIHZhbHVlKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBhdXRoZW50aWNhdGlvbih1c2VybmFtZTogc3RyaW5nLCBwYXNzd29yZDogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLmF1dGhlbnRpY2F0aW9uLmJpbmQodGhpcy5kcml2ZXIsIHVzZXJuYW1lLCBwYXNzd29yZCkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgdXNlcmFnZW50KHVzZXJhZ2VudDogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLnVzZXJhZ2VudC5iaW5kKHRoaXMuZHJpdmVyLCB1c2VyYWdlbnQpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGFzeW5jIHJ1bigpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBmb3IobGV0IGJsb2NrIG9mIHRoaXMuX3F1ZXVlKXtcbiAgICAgIGF3YWl0IGJsb2NrKCk7XG4gICAgfVxuXG4gICAgdGhpcy5fcXVldWUgPSBbXTtcbiAgfVxuXG4gIGFzeW5jIGVuZCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLnJ1bigpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEVsZWN0cm9saXplcjsiXX0=