"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.Electrolizer = exports.ElectrolizerType = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _electron = require("electron");

var _drivers = require("./drivers");

var ElectrolizerType;
exports.ElectrolizerType = ElectrolizerType;

(function (ElectrolizerType) {
  ElectrolizerType["webview"] = "webview";
  ElectrolizerType["browserView"] = "browserView";
  ElectrolizerType["browserWindow"] = "browserWindow";
})(ElectrolizerType || (exports.ElectrolizerType = ElectrolizerType = {}));

class Electrolizer {
  constructor(bus) {
    this.bus = bus;
    (0, _defineProperty2.default)(this, "_queue", []);
    (0, _defineProperty2.default)(this, "driver", void 0);
    (0, _defineProperty2.default)(this, "cookies", {
      clearAll: () => {
        this.queue(() => this.driver.cookies.clearAll());
        return this;
      },
      get: arg => {
        return this.driver.cookies.get(arg);
      },
      set: (name, value) => {
        //@ts-ignore
        this.queue(() => this.driver.cookies.set(name, value));
        return this;
      },
      clear: name => {
        this.queue(() => this.driver.cookies.clear(name));
        return this;
      }
    });
    this.setupDriver();
  }

  setupDriver() {
    switch (this.busType) {
      case ElectrolizerType.webview:
        this.driver = new _drivers.WebviewTagDriver(this.bus);
        break;

      case ElectrolizerType.browserWindow:
        this.driver = new _drivers.BrowserWindowDriver(this.bus);
        break;

      case ElectrolizerType.browserView:
        this.driver = new _drivers.BrowserViewDriver(this.bus);
        break;
    }
  }

  get busType() {
    try {
      var instanceOfTest = this.bus instanceof _electron.BrowserView;
    } catch (error) {
      return ElectrolizerType.webview;
    }

    if (this.bus instanceof _electron.BrowserView) {
      return ElectrolizerType.browserView;
    }

    if (this.bus instanceof _electron.BrowserWindow) {
      return ElectrolizerType.browserWindow;
    }

    return ElectrolizerType.webview;
  }

  queue(fn) {
    this._queue.push(fn);
  }

  goto(url, headers) {
    this.queue(this.driver.goto.bind(this.driver, url, headers));
    return this;
  }

  back() {
    this.queue(this.driver.back.bind(this.driver));
    return this;
  }

  forward() {
    this.queue(this.driver.forward.bind(this.driver));
    return this;
  }

  refresh() {
    this.queue(this.driver.refresh.bind(this.driver));
    return this;
  }

  click(selector) {
    this.queue(this.driver.click.bind(this.driver, selector));
    return this;
  }

  mousedown(selector) {
    this.queue(this.driver.mousedown.bind(this.driver, selector));
    return this;
  }

  mouseup(selector) {
    this.queue(this.driver.mouseup.bind(this.driver, selector));
    return this;
  }

  mouseover(selector) {
    this.queue(this.driver.mouseover.bind(this.driver, selector));
    return this;
  }

  mouseout(selector) {
    this.queue(this.driver.mouseout.bind(this.driver, selector));
    return this;
  }

  focus(selector) {
    this.queue(this.driver.focus.bind(this.driver, selector));
    return this;
  }

  blur(selector) {
    this.queue(this.driver.focus.bind(this.driver, selector));
    return this;
  }

  type(selector, text) {
    this.queue(this.driver.type.bind(this.driver, selector, text));
    return this;
  }

  insert(selector, text) {
    this.queue(this.driver.insert.bind(this.driver, selector, text));
    return this;
  }

  check(selector) {
    this.queue(this.driver.check.bind(this.driver, selector));
    return this;
  }

  uncheck(selector) {
    this.queue(this.driver.uncheck.bind(this.driver, selector));
    return this;
  }

  select(selector, option) {
    this.queue(this.driver.select.bind(this.driver, selector, option));
    return this;
  }

  scrollTo(top, left) {
    this.queue(this.driver.scrollTo.bind(this.driver, top, left));
    return this;
  }

  viewport(width, height) {
    this.queue(this.driver.viewport.bind(this.driver, width, height));
    return this;
  }

  inject(type, file) {
    this.queue(this.driver.inject.bind(this.driver, type, file));
    return this;
  }

  exists(selector) {
    var _this = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this.run();
      return yield _this.driver.exists(selector);
    })();
  }

  html() {
    var _this2 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this2.run();
      return yield _this2.driver.html();
    })();
  }

  evaluate(fn) {
    var _arguments = arguments,
        _this3 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      for (var _len = _arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
        args[_key - 1] = _arguments[_key];
      }

      yield _this3.run();
      return _this3.driver.evaluate(fn, ...args);
    })();
  }

  url() {
    var _this4 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this4.run();
      return yield _this4.driver.url();
    })();
  }

  path() {
    var _this5 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this5.run();
      return yield _this5.driver.path();
    })();
  }

  title() {
    var _this6 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this6.run();
      return yield _this6.driver.title();
    })();
  }

  pdf(options) {
    var _this7 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this7.run();
      return yield _this7.driver.pdf(options);
    })();
  }

  screenshot(rect, options) {
    var _this8 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this8.run();
      return yield _this8.driver.screenshot(rect, options);
    })();
  }

  wait() {
    //@ts-ignore
    this.queue(() => this.driver.wait.apply(this.driver, arguments));
    return this;
  }

  header(header, value) {
    this.queue(this.driver.header.bind(this.driver, header, value));
    return this;
  }

  authentication(username, password) {
    this.queue(this.driver.authentication.bind(this.driver, username, password));
    return this;
  }

  useragent(useragent) {
    this.queue(this.driver.useragent.bind(this.driver, useragent));
    return this;
  }

  run() {
    var _this9 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      for (var block of _this9._queue) {
        yield block();
      }

      _this9._queue = [];
    })();
  }

  end() {
    var _this10 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _this10.run();
    })();
  }

}

exports.Electrolizer = Electrolizer;
var _default = Electrolizer;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lbGVjdHJvbGl6ZXIuY2xhc3MudHMiXSwibmFtZXMiOlsiRWxlY3Ryb2xpemVyVHlwZSIsIkVsZWN0cm9saXplciIsImNvbnN0cnVjdG9yIiwiYnVzIiwiY2xlYXJBbGwiLCJxdWV1ZSIsImRyaXZlciIsImNvb2tpZXMiLCJnZXQiLCJhcmciLCJzZXQiLCJuYW1lIiwidmFsdWUiLCJjbGVhciIsInNldHVwRHJpdmVyIiwiYnVzVHlwZSIsIndlYnZpZXciLCJXZWJ2aWV3VGFnRHJpdmVyIiwiYnJvd3NlcldpbmRvdyIsIkJyb3dzZXJXaW5kb3dEcml2ZXIiLCJicm93c2VyVmlldyIsIkJyb3dzZXJWaWV3RHJpdmVyIiwiaW5zdGFuY2VPZlRlc3QiLCJCcm93c2VyVmlldyIsImVycm9yIiwiQnJvd3NlcldpbmRvdyIsImZuIiwiX3F1ZXVlIiwicHVzaCIsImdvdG8iLCJ1cmwiLCJoZWFkZXJzIiwiYmluZCIsImJhY2siLCJmb3J3YXJkIiwicmVmcmVzaCIsImNsaWNrIiwic2VsZWN0b3IiLCJtb3VzZWRvd24iLCJtb3VzZXVwIiwibW91c2VvdmVyIiwibW91c2VvdXQiLCJmb2N1cyIsImJsdXIiLCJ0eXBlIiwidGV4dCIsImluc2VydCIsImNoZWNrIiwidW5jaGVjayIsInNlbGVjdCIsIm9wdGlvbiIsInNjcm9sbFRvIiwidG9wIiwibGVmdCIsInZpZXdwb3J0Iiwid2lkdGgiLCJoZWlnaHQiLCJpbmplY3QiLCJmaWxlIiwiZXhpc3RzIiwicnVuIiwiaHRtbCIsImV2YWx1YXRlIiwiYXJncyIsInBhdGgiLCJ0aXRsZSIsInBkZiIsIm9wdGlvbnMiLCJzY3JlZW5zaG90IiwicmVjdCIsIndhaXQiLCJhcHBseSIsImFyZ3VtZW50cyIsImhlYWRlciIsImF1dGhlbnRpY2F0aW9uIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsInVzZXJhZ2VudCIsImJsb2NrIiwiZW5kIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUE7O0FBRUE7O0lBSVlBLGdC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Q0FBVyxLQUFLQyxNQUFMLENBQVl1RSxTQUFaLENBQXNCN0MsSUFBdEIsQ0FBMkIsS0FBSzFCLE1BQWhDLEVBQXdDdUUsU0FBeEMsQ0FBWDtBQUNBLFdBQU8sSUFBUDtBQUNEOztBQUVLakIsRUFBQUEsR0FBTixHQUEyQjtBQUFBOztBQUFBO0FBQ3pCLFdBQUksSUFBSWtCLEtBQVIsSUFBaUIsTUFBSSxDQUFDbkQsTUFBdEIsRUFBNkI7QUFDM0IsY0FBTW1ELEtBQUssRUFBWDtBQUNEOztBQUVELE1BQUEsTUFBSSxDQUFDbkQsTUFBTCxHQUFjLEVBQWQ7QUFMeUI7QUFNMUI7O0FBRUtvRCxFQUFBQSxHQUFOLEdBQTJCO0FBQUE7O0FBQUE7QUFDekIsTUFBQSxPQUFJLENBQUNuQixHQUFMO0FBRHlCO0FBRTFCOztBQTlPeUg7OztlQWlQN0czRCxZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQnJvd3NlclZpZXcsIEJyb3dzZXJXaW5kb3csIFdlYnZpZXdUYWcsIFdlYkNvbnRlbnRzIH0gZnJvbSAnZWxlY3Ryb24nO1xuaW1wb3J0IHsgT3BlcmF0b3JGdW5jdGlvbnMgfSBmcm9tICcuL29wZXJhdG9yLWZ1bmN0aW9ucy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgV2Vidmlld1RhZ0RyaXZlciwgQnJvd3NlclZpZXdEcml2ZXIsIEJyb3dzZXJXaW5kb3dEcml2ZXIgfSBmcm9tICcuL2RyaXZlcnMnO1xuaW1wb3J0IHsgUHVzaCB9IGZyb20gJy4vZXZhbHVhdGUtZnVuY3Rpb24udHlwZSc7XG5pbXBvcnQgeyBDb29raWVzIH0gZnJvbSAnLi9kcml2ZXJzL2Nvb2tpZXMuaW50ZXJmYWNlJztcblxuZXhwb3J0IGVudW0gRWxlY3Ryb2xpemVyVHlwZSB7XG4gIHdlYnZpZXcgPSAnd2VidmlldycsXG4gIGJyb3dzZXJWaWV3ID0gJ2Jyb3dzZXJWaWV3JyxcbiAgYnJvd3NlcldpbmRvdyA9ICdicm93c2VyV2luZG93J1xufVxuXG5cbmV4cG9ydCBjbGFzcyBFbGVjdHJvbGl6ZXI8VCBleHRlbmRzIFdlYnZpZXdUYWcgfCBCcm93c2VyVmlldyB8IEJyb3dzZXJXaW5kb3c+IGltcGxlbWVudHMgT3BlcmF0b3JGdW5jdGlvbnM8RWxlY3Ryb2xpemVyPFQ+PiB7XG5cbiAgcHJpdmF0ZSBfcXVldWU6ICgoKSA9PiBQcm9taXNlPGFueT4pW10gPSBbXTtcblxuICBwcml2YXRlIGRyaXZlciE6IFdlYnZpZXdUYWdEcml2ZXIgfCBCcm93c2VyV2luZG93RHJpdmVyIHwgQnJvd3NlclZpZXdEcml2ZXI7XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIGJ1czogVCl7XG4gICAgdGhpcy5zZXR1cERyaXZlcigpO1xuICB9XG5cbiAgY29va2llczogQ29va2llczxFbGVjdHJvbGl6ZXI8VD4+ID0ge1xuICAgIGNsZWFyQWxsOiAoKSA9PiB7IFxuICAgICAgdGhpcy5xdWV1ZSggKCkgPT4gdGhpcy5kcml2ZXIuY29va2llcy5jbGVhckFsbCgpICk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIGdldDogKGFyZz86IGFueSkgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuZHJpdmVyLmNvb2tpZXMuZ2V0KGFyZylcbiAgICB9LFxuICAgIHNldDogKG5hbWU6IHN0cmluZyB8IEVsZWN0cm9uLkNvb2tpZSwgdmFsdWU/OiBzdHJpbmcpID0+IHtcbiAgICAgIC8vQHRzLWlnbm9yZVxuICAgICAgdGhpcy5xdWV1ZSgoKSA9PiB0aGlzLmRyaXZlci5jb29raWVzLnNldChuYW1lLCB2YWx1ZSkpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBjbGVhcjogKG5hbWU/OiBzdHJpbmcpID0+IHtcbiAgICAgIHRoaXMucXVldWUoKCkgPT4gdGhpcy5kcml2ZXIuY29va2llcy5jbGVhcihuYW1lKSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICB9XG5cbiAgXG4gIHByaXZhdGUgc2V0dXBEcml2ZXIoKXtcbiAgICBzd2l0Y2godGhpcy5idXNUeXBlKXtcbiAgICAgIGNhc2UgRWxlY3Ryb2xpemVyVHlwZS53ZWJ2aWV3OlxuICAgICAgICB0aGlzLmRyaXZlciA9IG5ldyBXZWJ2aWV3VGFnRHJpdmVyKHRoaXMuYnVzIGFzIFdlYnZpZXdUYWcpO1xuICAgICAgYnJlYWs7XG4gICAgICBcbiAgICAgIGNhc2UgRWxlY3Ryb2xpemVyVHlwZS5icm93c2VyV2luZG93OlxuICAgICAgICB0aGlzLmRyaXZlciA9IG5ldyBCcm93c2VyV2luZG93RHJpdmVyKHRoaXMuYnVzIGFzIEJyb3dzZXJXaW5kb3cpO1xuICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgRWxlY3Ryb2xpemVyVHlwZS5icm93c2VyVmlldzpcbiAgICAgICAgdGhpcy5kcml2ZXIgPSBuZXcgQnJvd3NlclZpZXdEcml2ZXIodGhpcy5idXMgYXMgQnJvd3NlclZpZXcpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBcbiAgZ2V0IGJ1c1R5cGUoKTogRWxlY3Ryb2xpemVyVHlwZSB7XG4gICAgdHJ5IHtcbiAgICAgIGxldCBpbnN0YW5jZU9mVGVzdCA9IHRoaXMuYnVzIGluc3RhbmNlb2YgQnJvd3NlclZpZXc7XG4gICAgfSBjYXRjaChlcnJvcil7XG4gICAgICByZXR1cm4gRWxlY3Ryb2xpemVyVHlwZS53ZWJ2aWV3O1xuICAgIH1cblxuICAgIGlmKHRoaXMuYnVzIGluc3RhbmNlb2YgQnJvd3NlclZpZXcpe1xuICAgICAgcmV0dXJuIEVsZWN0cm9saXplclR5cGUuYnJvd3NlclZpZXc7XG4gICAgfVxuXG4gICAgaWYodGhpcy5idXMgaW5zdGFuY2VvZiBCcm93c2VyV2luZG93KXtcbiAgICAgIHJldHVybiBFbGVjdHJvbGl6ZXJUeXBlLmJyb3dzZXJXaW5kb3c7XG4gICAgfVxuXG4gICAgcmV0dXJuIEVsZWN0cm9saXplclR5cGUud2VidmlldztcbiAgfVxuICBcbiAgcHJpdmF0ZSBxdWV1ZShmbjogKCkgPT4gUHJvbWlzZTxhbnk+KXtcbiAgICB0aGlzLl9xdWV1ZS5wdXNoKGZuKTtcbiAgfVxuXG4gIGdvdG8odXJsOiBzdHJpbmcsIGhlYWRlcnM/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLmdvdG8uYmluZCh0aGlzLmRyaXZlciwgdXJsLCBoZWFkZXJzKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBiYWNrKCk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci5iYWNrLmJpbmQodGhpcy5kcml2ZXIpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGZvcndhcmQoKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLmZvcndhcmQuYmluZCh0aGlzLmRyaXZlcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgcmVmcmVzaCgpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIucmVmcmVzaC5iaW5kKHRoaXMuZHJpdmVyKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBjbGljayhzZWxlY3Rvcjogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLmNsaWNrLmJpbmQodGhpcy5kcml2ZXIsIHNlbGVjdG9yKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBtb3VzZWRvd24oc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci5tb3VzZWRvd24uYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG1vdXNldXAoc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci5tb3VzZXVwLmJpbmQodGhpcy5kcml2ZXIsIHNlbGVjdG9yKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBtb3VzZW92ZXIoc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci5tb3VzZW92ZXIuYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG1vdXNlb3V0KHNlbGVjdG9yOiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIubW91c2VvdXQuYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGZvY3VzKHNlbGVjdG9yOiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIuZm9jdXMuYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGJsdXIoc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci5mb2N1cy5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgdHlwZShzZWxlY3Rvcjogc3RyaW5nLCB0ZXh0Pzogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLnR5cGUuYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IsIHRleHQpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGluc2VydChzZWxlY3Rvcjogc3RyaW5nLCB0ZXh0Pzogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLmluc2VydC5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvciwgdGV4dCkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgY2hlY2soc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci5jaGVjay5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgdW5jaGVjayhzZWxlY3Rvcjogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLnVuY2hlY2suYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHNlbGVjdChzZWxlY3Rvcjogc3RyaW5nLCBvcHRpb24/OiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIuc2VsZWN0LmJpbmQodGhpcy5kcml2ZXIsIHNlbGVjdG9yLCBvcHRpb24pKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHNjcm9sbFRvKHRvcDogbnVtYmVyLCBsZWZ0OiBudW1iZXIpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIuc2Nyb2xsVG8uYmluZCh0aGlzLmRyaXZlciwgdG9wLCBsZWZ0KSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICB2aWV3cG9ydCh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcik6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci52aWV3cG9ydC5iaW5kKHRoaXMuZHJpdmVyLCB3aWR0aCwgaGVpZ2h0KSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBpbmplY3QodHlwZTogJ2pzJyB8ICdjc3MnLCBmaWxlOiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIuaW5qZWN0LmJpbmQodGhpcy5kcml2ZXIsIHR5cGUsIGZpbGUpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGFzeW5jIGV4aXN0cyhzZWxlY3Rvcjogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgYXdhaXQgdGhpcy5ydW4oKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5kcml2ZXIuZXhpc3RzKHNlbGVjdG9yKTtcbiAgfVxuXG4gIGFzeW5jIGh0bWwoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBhd2FpdCB0aGlzLnJ1bigpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmRyaXZlci5odG1sKCk7XG4gIH1cblxuICBhc3luYyBldmFsdWF0ZTxULCBLIGV4dGVuZHMgYW55W10sIFI+KGZuOiAoLi4uYXJnczogUHVzaDxLLCBUPikgPT4gUiwgLi4uYXJnczogSyk6IFByb21pc2U8Uj4ge1xuICAgIGF3YWl0IHRoaXMucnVuKCk7XG4gICAgcmV0dXJuIHRoaXMuZHJpdmVyLmV2YWx1YXRlKGZuLCAuLi5hcmdzKTtcbiAgfVxuXG4gIGFzeW5jIHVybCgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGF3YWl0IHRoaXMucnVuKCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZHJpdmVyLnVybCgpO1xuICB9XG5cbiAgYXN5bmMgcGF0aCgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGF3YWl0IHRoaXMucnVuKCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZHJpdmVyLnBhdGgoKTtcbiAgfVxuXG4gIGFzeW5jIHRpdGxlKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgYXdhaXQgdGhpcy5ydW4oKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5kcml2ZXIudGl0bGUoKTtcbiAgfVxuXG4gIGFzeW5jIHBkZihvcHRpb25zPzogRWxlY3Ryb24uUHJpbnRUb1BERk9wdGlvbnMpOiBQcm9taXNlPEJ1ZmZlcj4ge1xuICAgIGF3YWl0IHRoaXMucnVuKCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZHJpdmVyLnBkZihvcHRpb25zKTtcbiAgfVxuXG4gIGFzeW5jIHNjcmVlbnNob3QocmVjdDogRWxlY3Ryb24uUmVjdGFuZ2xlLCBvcHRpb25zOiBFbGVjdHJvbi5Ub1BOR09wdGlvbnMpOiBQcm9taXNlPEJ1ZmZlcj4ge1xuICAgIGF3YWl0IHRoaXMucnVuKCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZHJpdmVyLnNjcmVlbnNob3QocmVjdCwgb3B0aW9ucyk7XG4gIH1cblxuICB3YWl0KG1zOiBudW1iZXIpOiBFbGVjdHJvbGl6ZXI8VD5cbiAgd2FpdChzZWxlY3Rvcjogc3RyaW5nLCBkZWxheT86IG51bWJlcik6IEVsZWN0cm9saXplcjxUPlxuICB3YWl0PFIsIEsgZXh0ZW5kcyBhbnlbXT4oZm46ICguLi5hcmdzOiBQdXNoPEssIFI+KSA9PiBib29sZWFuIHwgUHJvbWlzZTxib29sZWFuPiAsIC4uLmFyZ3M6IEspOiBFbGVjdHJvbGl6ZXI8VD5cbiAgd2FpdCgpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIC8vQHRzLWlnbm9yZVxuICAgIHRoaXMucXVldWUoKCkgPT4gdGhpcy5kcml2ZXIud2FpdC5hcHBseSh0aGlzLmRyaXZlciwgYXJndW1lbnRzKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBoZWFkZXIoaGVhZGVyPzogc3RyaW5nLCB2YWx1ZT86IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci5oZWFkZXIuYmluZCh0aGlzLmRyaXZlciwgaGVhZGVyLCB2YWx1ZSkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYXV0aGVudGljYXRpb24odXNlcm5hbWU6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci5hdXRoZW50aWNhdGlvbi5iaW5kKHRoaXMuZHJpdmVyLCB1c2VybmFtZSwgcGFzc3dvcmQpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHVzZXJhZ2VudCh1c2VyYWdlbnQ6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci51c2VyYWdlbnQuYmluZCh0aGlzLmRyaXZlciwgdXNlcmFnZW50KSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBhc3luYyBydW4oKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgZm9yKGxldCBibG9jayBvZiB0aGlzLl9xdWV1ZSl7XG4gICAgICBhd2FpdCBibG9jaygpO1xuICAgIH1cblxuICAgIHRoaXMuX3F1ZXVlID0gW107XG4gIH1cblxuICBhc3luYyBlbmQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5ydW4oKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBFbGVjdHJvbGl6ZXI7Il19