"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.Electrolizer = exports.ElectrolizerType = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _drivers = require("./drivers");

var ElectrolizerType;
exports.ElectrolizerType = ElectrolizerType;

(function (ElectrolizerType) {
  ElectrolizerType["webview"] = "webview";
  ElectrolizerType["browserView"] = "browserView";
  ElectrolizerType["browserWindow"] = "browserWindow";
})(ElectrolizerType || (exports.ElectrolizerType = ElectrolizerType = {}));

class Electrolizer {
  constructor(bus) {
    this.bus = bus;
    (0, _defineProperty2.default)(this, "_queue", []);
    (0, _defineProperty2.default)(this, "driver", void 0);
    (0, _defineProperty2.default)(this, "cookies", {
      clearAll: () => {
        this.queue(() => this.driver.cookies.clearAll());
        return this;
      },
      get: arg => {
        return this.driver.cookies.get(arg);
      },
      set: (name, value) => {
        //@ts-ignore
        this.queue(() => this.driver.cookies.set(name, value));
        return this;
      },
      clear: name => {
        this.queue(() => this.driver.cookies.clear(name));
        return this;
      }
    });
    this.setupDriver();
  }

  setupDriver() {
    switch (this.busType) {
      case ElectrolizerType.webview:
        this.driver = new _drivers.WebviewTagDriver(this.bus, this.busType);
        break;

      case ElectrolizerType.browserWindow:
        this.driver = new _drivers.BrowserWindowDriver(this.bus, this.busType);
        break;

      case ElectrolizerType.browserView:
        this.driver = new _drivers.BrowserViewDriver(this.bus, this.busType);
        break;
    }
  }

  get busType() {
    if (this.bus.hasOwnProperty('webContents')) {
      return ElectrolizerType.browserWindow;
    }

    return ElectrolizerType.webview;
  }

  queue(fn) {
    this._queue.push(fn);
  }

  goto(url, headers) {
    this.queue(this.driver.goto.bind(this.driver, url, headers));
    return this;
  }

  back() {
    this.queue(this.driver.back.bind(this.driver));
    return this;
  }

  forward() {
    this.queue(this.driver.forward.bind(this.driver));
    return this;
  }

  refresh() {
    this.queue(this.driver.refresh.bind(this.driver));
    return this;
  }

  click(selector) {
    this.queue(this.driver.click.bind(this.driver, selector));
    return this;
  }

  mousedown(selector) {
    this.queue(this.driver.mousedown.bind(this.driver, selector));
    return this;
  }

  mouseup(selector) {
    this.queue(this.driver.mouseup.bind(this.driver, selector));
    return this;
  }

  mouseover(selector) {
    this.queue(this.driver.mouseover.bind(this.driver, selector));
    return this;
  }

  mouseout(selector) {
    this.queue(this.driver.mouseout.bind(this.driver, selector));
    return this;
  }

  focus(selector) {
    this.queue(this.driver.focus.bind(this.driver, selector));
    return this;
  }

  blur(selector) {
    this.queue(this.driver.focus.bind(this.driver, selector));
    return this;
  }

  type(selector, text) {
    this.queue(this.driver.type.bind(this.driver, selector, text));
    return this;
  }

  insert(selector, text) {
    this.queue(this.driver.insert.bind(this.driver, selector, text));
    return this;
  }

  check(selector) {
    this.queue(this.driver.check.bind(this.driver, selector));
    return this;
  }

  uncheck(selector) {
    this.queue(this.driver.uncheck.bind(this.driver, selector));
    return this;
  }

  select(selector, option) {
    this.queue(this.driver.select.bind(this.driver, selector, option));
    return this;
  }

  scrollTo(top, left) {
    this.queue(this.driver.scrollTo.bind(this.driver, top, left));
    return this;
  }

  viewport(width, height) {
    this.queue(this.driver.viewport.bind(this.driver, width, height));
    return this;
  }

  inject(type, file) {
    this.queue(this.driver.inject.bind(this.driver, type, file));
    return this;
  }

  exists(selector) {
    var _this = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this.run();
      return yield _this.driver.exists(selector);
    })();
  }

  html() {
    var _this2 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this2.run();
      return yield _this2.driver.html();
    })();
  }

  evaluate(fn) {
    var _arguments = arguments,
        _this3 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      for (var _len = _arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
        args[_key - 1] = _arguments[_key];
      }

      yield _this3.run();
      return _this3.driver.evaluate(fn, ...args);
    })();
  }

  url() {
    var _this4 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this4.run();
      return yield _this4.driver.url();
    })();
  }

  path() {
    var _this5 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this5.run();
      return yield _this5.driver.path();
    })();
  }

  title() {
    var _this6 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this6.run();
      return yield _this6.driver.title();
    })();
  }

  pdf(options) {
    var _this7 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this7.run();
      return yield _this7.driver.pdf(options);
    })();
  }

  screenshot(rect, options) {
    var _this8 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this8.run();
      return yield _this8.driver.screenshot(rect, options);
    })();
  }

  wait() {
    //@ts-ignore
    this.queue(() => this.driver.wait.apply(this.driver, arguments));
    return this;
  }

  header(header, value) {
    this.queue(this.driver.header.bind(this.driver, header, value));
    return this;
  }

  authentication(username, password) {
    this.queue(this.driver.authentication.bind(this.driver, username, password));
    return this;
  }

  useragent(useragent) {
    this.queue(this.driver.useragent.bind(this.driver, useragent));
    return this;
  }

  run() {
    var _this9 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      for (var block of _this9._queue) {
        yield block();
      }

      _this9._queue = [];
    })();
  }

  end() {
    var _this10 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _this10.run();
    })();
  }

}

exports.Electrolizer = Electrolizer;
var _default = Electrolizer;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lbGVjdHJvbGl6ZXIuY2xhc3MudHMiXSwibmFtZXMiOlsiRWxlY3Ryb2xpemVyVHlwZSIsIkVsZWN0cm9saXplciIsImNvbnN0cnVjdG9yIiwiYnVzIiwiY2xlYXJBbGwiLCJxdWV1ZSIsImRyaXZlciIsImNvb2tpZXMiLCJnZXQiLCJhcmciLCJzZXQiLCJuYW1lIiwidmFsdWUiLCJjbGVhciIsInNldHVwRHJpdmVyIiwiYnVzVHlwZSIsIndlYnZpZXciLCJXZWJ2aWV3VGFnRHJpdmVyIiwiYnJvd3NlcldpbmRvdyIsIkJyb3dzZXJXaW5kb3dEcml2ZXIiLCJicm93c2VyVmlldyIsIkJyb3dzZXJWaWV3RHJpdmVyIiwiaGFzT3duUHJvcGVydHkiLCJmbiIsIl9xdWV1ZSIsInB1c2giLCJnb3RvIiwidXJsIiwiaGVhZGVycyIsImJpbmQiLCJiYWNrIiwiZm9yd2FyZCIsInJlZnJlc2giLCJjbGljayIsInNlbGVjdG9yIiwibW91c2Vkb3duIiwibW91c2V1cCIsIm1vdXNlb3ZlciIsIm1vdXNlb3V0IiwiZm9jdXMiLCJibHVyIiwidHlwZSIsInRleHQiLCJpbnNlcnQiLCJjaGVjayIsInVuY2hlY2siLCJzZWxlY3QiLCJvcHRpb24iLCJzY3JvbGxUbyIsInRvcCIsImxlZnQiLCJ2aWV3cG9ydCIsIndpZHRoIiwiaGVpZ2h0IiwiaW5qZWN0IiwiZmlsZSIsImV4aXN0cyIsInJ1biIsImh0bWwiLCJldmFsdWF0ZSIsImFyZ3MiLCJwYXRoIiwidGl0bGUiLCJwZGYiLCJvcHRpb25zIiwic2NyZWVuc2hvdCIsInJlY3QiLCJ3YWl0IiwiYXBwbHkiLCJhcmd1bWVudHMiLCJoZWFkZXIiLCJhdXRoZW50aWNhdGlvbiIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJ1c2VyYWdlbnQiLCJibG9jayIsImVuZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUVBOztJQUlZQSxnQjs7O1dBQUFBLGdCO0FBQUFBLEVBQUFBLGdCO0FBQUFBLEVBQUFBLGdCO0FB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QTZCO0FBQzNCLGNBQU1tRCxLQUFLLEVBQVg7QUFDRDs7QUFFRCxNQUFBLE1BQUksQ0FBQ25ELE1BQUwsR0FBYyxFQUFkO0FBTHlCO0FBTTFCOztBQUVLb0QsRUFBQUEsR0FBTixHQUEyQjtBQUFBOztBQUFBO0FBQ3pCLE1BQUEsT0FBSSxDQUFDbkIsR0FBTDtBQUR5QjtBQUUxQjs7QUFuT21KOzs7ZUFzT3ZJeEQsWSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVsZWN0cm9uU2hpbXMgfSBmcm9tICcuL3NoaW1zL2VsZWN0cm9uLXNoaW1zJztcbmltcG9ydCB7IE9wZXJhdG9yRnVuY3Rpb25zIH0gZnJvbSAnLi9vcGVyYXRvci1mdW5jdGlvbnMuaW50ZXJmYWNlJztcbmltcG9ydCB7IFdlYnZpZXdUYWdEcml2ZXIsIEJyb3dzZXJWaWV3RHJpdmVyLCBCcm93c2VyV2luZG93RHJpdmVyIH0gZnJvbSAnLi9kcml2ZXJzJztcbmltcG9ydCB7IFB1c2ggfSBmcm9tICcuL2V2YWx1YXRlLWZ1bmN0aW9uLnR5cGUnO1xuaW1wb3J0IHsgQ29va2llcyB9IGZyb20gJy4vZHJpdmVycy9jb29raWVzLmludGVyZmFjZSc7XG5cbmV4cG9ydCBlbnVtIEVsZWN0cm9saXplclR5cGUge1xuICB3ZWJ2aWV3ID0gJ3dlYnZpZXcnLFxuICBicm93c2VyVmlldyA9ICdicm93c2VyVmlldycsXG4gIGJyb3dzZXJXaW5kb3cgPSAnYnJvd3NlcldpbmRvdydcbn1cblxuXG5leHBvcnQgY2xhc3MgRWxlY3Ryb2xpemVyPFQgZXh0ZW5kcyBFbGVjdHJvblNoaW1zLldlYnZpZXdUYWdMaWtlIHwgRWxlY3Ryb25TaGltcy5Ccm93c2VyV2luZG93Vmlld0xpa2U+IGltcGxlbWVudHMgT3BlcmF0b3JGdW5jdGlvbnM8RWxlY3Ryb2xpemVyPFQ+PiB7XG5cbiAgcHJpdmF0ZSBfcXVldWU6ICgoKSA9PiBQcm9taXNlPGFueT4pW10gPSBbXTtcblxuICBwcml2YXRlIGRyaXZlciE6IFdlYnZpZXdUYWdEcml2ZXIgfCBCcm93c2VyV2luZG93RHJpdmVyIHwgQnJvd3NlclZpZXdEcml2ZXI7XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIGJ1czogVCl7XG4gICAgdGhpcy5zZXR1cERyaXZlcigpO1xuICB9XG5cbiAgY29va2llczogQ29va2llczxFbGVjdHJvbGl6ZXI8VD4+ID0ge1xuICAgIGNsZWFyQWxsOiAoKSA9PiB7IFxuICAgICAgdGhpcy5xdWV1ZSggKCkgPT4gdGhpcy5kcml2ZXIuY29va2llcy5jbGVhckFsbCgpICk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIGdldDogKGFyZz86IGFueSkgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuZHJpdmVyLmNvb2tpZXMuZ2V0KGFyZylcbiAgICB9LFxuICAgIHNldDogKG5hbWU6IHN0cmluZyB8IEVsZWN0cm9uLkNvb2tpZSwgdmFsdWU/OiBzdHJpbmcpID0+IHtcbiAgICAgIC8vQHRzLWlnbm9yZVxuICAgICAgdGhpcy5xdWV1ZSgoKSA9PiB0aGlzLmRyaXZlci5jb29raWVzLnNldChuYW1lLCB2YWx1ZSkpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBjbGVhcjogKG5hbWU/OiBzdHJpbmcpID0+IHtcbiAgICAgIHRoaXMucXVldWUoKCkgPT4gdGhpcy5kcml2ZXIuY29va2llcy5jbGVhcihuYW1lKSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICB9XG5cbiAgXG4gIHByaXZhdGUgc2V0dXBEcml2ZXIoKXtcbiAgICBzd2l0Y2godGhpcy5idXNUeXBlKXtcbiAgICAgIGNhc2UgRWxlY3Ryb2xpemVyVHlwZS53ZWJ2aWV3OlxuICAgICAgICB0aGlzLmRyaXZlciA9IG5ldyBXZWJ2aWV3VGFnRHJpdmVyKHRoaXMuYnVzIGFzIEVsZWN0cm9uU2hpbXMuV2Vidmlld1RhZ0xpa2UsIHRoaXMuYnVzVHlwZSk7XG4gICAgICBicmVhaztcbiAgICAgIFxuICAgICAgY2FzZSBFbGVjdHJvbGl6ZXJUeXBlLmJyb3dzZXJXaW5kb3c6XG4gICAgICAgIHRoaXMuZHJpdmVyID0gbmV3IEJyb3dzZXJXaW5kb3dEcml2ZXIodGhpcy5idXMgYXMgRWxlY3Ryb25TaGltcy5Ccm93c2VyV2luZG93Vmlld0xpa2UsIHRoaXMuYnVzVHlwZSk7XG4gICAgICBicmVhaztcblxuICAgICAgY2FzZSBFbGVjdHJvbGl6ZXJUeXBlLmJyb3dzZXJWaWV3OlxuICAgICAgICB0aGlzLmRyaXZlciA9IG5ldyBCcm93c2VyVmlld0RyaXZlcih0aGlzLmJ1cyBhcyBFbGVjdHJvblNoaW1zLkJyb3dzZXJXaW5kb3dWaWV3TGlrZSwgdGhpcy5idXNUeXBlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgXG4gIGdldCBidXNUeXBlKCk6IEVsZWN0cm9saXplclR5cGUge1xuICAgIGlmKHRoaXMuYnVzLmhhc093blByb3BlcnR5KCd3ZWJDb250ZW50cycpKXtcbiAgICAgIHJldHVybiBFbGVjdHJvbGl6ZXJUeXBlLmJyb3dzZXJXaW5kb3c7XG4gICAgfVxuICAgIHJldHVybiBFbGVjdHJvbGl6ZXJUeXBlLndlYnZpZXc7XG4gIH1cbiAgXG4gIHByaXZhdGUgcXVldWUoZm46ICgpID0+IFByb21pc2U8YW55Pil7XG4gICAgdGhpcy5fcXVldWUucHVzaChmbik7XG4gIH1cblxuICBnb3RvKHVybDogc3RyaW5nLCBoZWFkZXJzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPik6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci5nb3RvLmJpbmQodGhpcy5kcml2ZXIsIHVybCwgaGVhZGVycykpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYmFjaygpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIuYmFjay5iaW5kKHRoaXMuZHJpdmVyKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBmb3J3YXJkKCk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci5mb3J3YXJkLmJpbmQodGhpcy5kcml2ZXIpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHJlZnJlc2goKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLnJlZnJlc2guYmluZCh0aGlzLmRyaXZlcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgY2xpY2soc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci5jbGljay5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgbW91c2Vkb3duKHNlbGVjdG9yOiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIubW91c2Vkb3duLmJpbmQodGhpcy5kcml2ZXIsIHNlbGVjdG9yKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBtb3VzZXVwKHNlbGVjdG9yOiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIubW91c2V1cC5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgbW91c2VvdmVyKHNlbGVjdG9yOiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIubW91c2VvdmVyLmJpbmQodGhpcy5kcml2ZXIsIHNlbGVjdG9yKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBtb3VzZW91dChzZWxlY3Rvcjogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLm1vdXNlb3V0LmJpbmQodGhpcy5kcml2ZXIsIHNlbGVjdG9yKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBmb2N1cyhzZWxlY3Rvcjogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLmZvY3VzLmJpbmQodGhpcy5kcml2ZXIsIHNlbGVjdG9yKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBibHVyKHNlbGVjdG9yOiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIuZm9jdXMuYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHR5cGUoc2VsZWN0b3I6IHN0cmluZywgdGV4dD86IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci50eXBlLmJpbmQodGhpcy5kcml2ZXIsIHNlbGVjdG9yLCB0ZXh0KSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBpbnNlcnQoc2VsZWN0b3I6IHN0cmluZywgdGV4dD86IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci5pbnNlcnQuYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IsIHRleHQpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGNoZWNrKHNlbGVjdG9yOiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIuY2hlY2suYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHVuY2hlY2soc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5xdWV1ZSh0aGlzLmRyaXZlci51bmNoZWNrLmJpbmQodGhpcy5kcml2ZXIsIHNlbGVjdG9yKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzZWxlY3Qoc2VsZWN0b3I6IHN0cmluZywgb3B0aW9uPzogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLnNlbGVjdC5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3Rvciwgb3B0aW9uKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzY3JvbGxUbyh0b3A6IG51bWJlciwgbGVmdDogbnVtYmVyKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLnNjcm9sbFRvLmJpbmQodGhpcy5kcml2ZXIsIHRvcCwgbGVmdCkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgdmlld3BvcnQod2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIudmlld3BvcnQuYmluZCh0aGlzLmRyaXZlciwgd2lkdGgsIGhlaWdodCkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgaW5qZWN0KHR5cGU6ICdqcycgfCAnY3NzJywgZmlsZTogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLnF1ZXVlKHRoaXMuZHJpdmVyLmluamVjdC5iaW5kKHRoaXMuZHJpdmVyLCB0eXBlLCBmaWxlKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBhc3luYyBleGlzdHMoc2VsZWN0b3I6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGF3YWl0IHRoaXMucnVuKCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZHJpdmVyLmV4aXN0cyhzZWxlY3Rvcik7XG4gIH1cblxuICBhc3luYyBodG1sKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgYXdhaXQgdGhpcy5ydW4oKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5kcml2ZXIuaHRtbCgpO1xuICB9XG5cbiAgYXN5bmMgZXZhbHVhdGU8VCwgSyBleHRlbmRzIGFueVtdLCBSPihmbjogKC4uLmFyZ3M6IFB1c2g8SywgVD4pID0+IFIsIC4uLmFyZ3M6IEspOiBQcm9taXNlPFI+IHtcbiAgICBhd2FpdCB0aGlzLnJ1bigpO1xuICAgIHJldHVybiB0aGlzLmRyaXZlci5ldmFsdWF0ZShmbiwgLi4uYXJncyk7XG4gIH1cblxuICBhc3luYyB1cmwoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBhd2FpdCB0aGlzLnJ1bigpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmRyaXZlci51cmwoKTtcbiAgfVxuXG4gIGFzeW5jIHBhdGgoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBhd2FpdCB0aGlzLnJ1bigpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmRyaXZlci5wYXRoKCk7XG4gIH1cblxuICBhc3luYyB0aXRsZSgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGF3YWl0IHRoaXMucnVuKCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZHJpdmVyLnRpdGxlKCk7XG4gIH1cblxuICBhc3luYyBwZGYob3B0aW9ucz86IEVsZWN0cm9uLlByaW50VG9QREZPcHRpb25zKTogUHJvbWlzZTxCdWZmZXI+IHtcbiAgICBhd2FpdCB0aGlzLnJ1bigpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmRyaXZlci5wZGYob3B0aW9ucyk7XG4gIH1cblxuICBhc3luYyBzY3JlZW5zaG90KHJlY3Q6IEVsZWN0cm9uLlJlY3RhbmdsZSwgb3B0aW9uczogRWxlY3Ryb24uVG9QTkdPcHRpb25zKTogUHJvbWlzZTxCdWZmZXI+IHtcbiAgICBhd2FpdCB0aGlzLnJ1bigpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmRyaXZlci5zY3JlZW5zaG90KHJlY3QsIG9wdGlvbnMpO1xuICB9XG5cbiAgd2FpdChtczogbnVtYmVyKTogRWxlY3Ryb2xpemVyPFQ+XG4gIHdhaXQoc2VsZWN0b3I6IHN0cmluZywgZGVsYXk/OiBudW1iZXIpOiBFbGVjdHJvbGl6ZXI8VD5cbiAgd2FpdDxSLCBLIGV4dGVuZHMgYW55W10+KGZuOiAoLi4uYXJnczogUHVzaDxLLCBSPikgPT4gYm9vbGVhbiB8IFByb21pc2U8Ym9vbGVhbj4gLCAuLi5hcmdzOiBLKTogRWxlY3Ryb2xpemVyPFQ+XG4gIHdhaXQoKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICAvL0B0cy1pZ25vcmVcbiAgICB0aGlzLnF1ZXVlKCgpID0+IHRoaXMuZHJpdmVyLndhaXQuYXBwbHkodGhpcy5kcml2ZXIsIGFyZ3VtZW50cykpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgaGVhZGVyKGhlYWRlcj86IHN0cmluZywgdmFsdWU/OiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIuaGVhZGVyLmJpbmQodGhpcy5kcml2ZXIsIGhlYWRlciwgdmFsdWUpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGF1dGhlbnRpY2F0aW9uKHVzZXJuYW1lOiBzdHJpbmcsIHBhc3N3b3JkOiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIuYXV0aGVudGljYXRpb24uYmluZCh0aGlzLmRyaXZlciwgdXNlcm5hbWUsIHBhc3N3b3JkKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICB1c2VyYWdlbnQodXNlcmFnZW50OiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMucXVldWUodGhpcy5kcml2ZXIudXNlcmFnZW50LmJpbmQodGhpcy5kcml2ZXIsIHVzZXJhZ2VudCkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYXN5bmMgcnVuKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGZvcihsZXQgYmxvY2sgb2YgdGhpcy5fcXVldWUpe1xuICAgICAgYXdhaXQgYmxvY2soKTtcbiAgICB9XG5cbiAgICB0aGlzLl9xdWV1ZSA9IFtdO1xuICB9XG5cbiAgYXN5bmMgZW5kKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMucnVuKCk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgRWxlY3Ryb2xpemVyOyJdfQ==