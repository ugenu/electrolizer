"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.Electrolizer = exports.ElectrolizerType = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _electron = require("electron");

var _drivers = require("./drivers");

var ElectrolizerType;
exports.ElectrolizerType = ElectrolizerType;

(function (ElectrolizerType) {
  ElectrolizerType["webview"] = "webview";
  ElectrolizerType["browserView"] = "browserView";
  ElectrolizerType["browserWindow"] = "browserWindow";
})(ElectrolizerType || (exports.ElectrolizerType = ElectrolizerType = {}));

class Electrolizer {
  constructor(bus) {
    this.bus = bus;
    (0, _defineProperty2.default)(this, "interactionReady", false);
    (0, _defineProperty2.default)(this, "queue", []);
    (0, _defineProperty2.default)(this, "driver", void 0);
    (0, _defineProperty2.default)(this, "cookies", {
      clearAll: () => {
        this._queue(() => this.driver.cookies.clearAll());

        return this;
      },
      get: arg => {
        return this.driver.cookies.get(arg);
      },
      set: (name, value) => {
        //@ts-ignore
        this._queue(() => this.driver.cookies.set(name, value));

        return this;
      },
      clear: name => {
        this._queue(() => this.driver.cookies.clear(name));

        return this;
      }
    });
    this.setupDriver();
  }

  setupDriver() {
    switch (this.busType) {
      case ElectrolizerType.webview:
        this.driver = new _drivers.WebviewTagDriver(this.bus);
        break;

      case ElectrolizerType.browserWindow:
        this.driver = new _drivers.BrowserWindowDriver(this.bus);
        break;

      case ElectrolizerType.browserView:
        this.driver = new _drivers.BrowserViewDriver(this.bus);
        break;
    }
  }

  get busType() {
    try {
      var instanceOfTest = this.bus instanceof _electron.BrowserView;
    } catch (error) {
      return ElectrolizerType.webview;
    }

    if (this.bus instanceof _electron.BrowserView) {
      return ElectrolizerType.browserView;
    }

    if (this.bus instanceof _electron.BrowserWindow) {
      return ElectrolizerType.browserWindow;
    }

    return ElectrolizerType.webview;
  }

  _queue(fn) {
    this.queue.push(fn);
  }

  goto(url, headers) {
    this._queue(this.driver.goto.bind(this.driver, url, headers));

    return this;
  }

  back() {
    this._queue(this.driver.back.bind(this.driver));

    return this;
  }

  forward() {
    this._queue(this.driver.forward.bind(this.driver));

    return this;
  }

  refresh() {
    this._queue(this.driver.refresh.bind(this.driver));

    return this;
  }

  click(selector) {
    this._queue(this.driver.click.bind(this.driver, selector));

    return this;
  }

  mousedown(selector) {
    this._queue(this.driver.mousedown.bind(this.driver, selector));

    return this;
  }

  mouseup(selector) {
    this._queue(this.driver.mouseup.bind(this.driver, selector));

    return this;
  }

  mouseover(selector) {
    this._queue(this.driver.mouseover.bind(this.driver, selector));

    return this;
  }

  mouseout(selector) {
    this._queue(this.driver.mouseout.bind(this.driver, selector));

    return this;
  }

  type(selector, text) {
    this._queue(this.driver.type.bind(this.driver, selector, text));

    return this;
  }

  insert(selector, text) {
    this._queue(this.driver.insert.bind(this.driver, selector, text));

    return this;
  }

  check(selector) {
    this._queue(this.driver.check.bind(this.driver, selector));

    return this;
  }

  uncheck(selector) {
    this._queue(this.driver.uncheck.bind(this.driver, selector));

    return this;
  }

  select(selector, option) {
    this._queue(this.driver.select.bind(this.driver, selector, option));

    return this;
  }

  scrollTo(top, left) {
    this._queue(this.driver.scrollTo.bind(this.driver, top, left));

    return this;
  }

  viewport(width, height) {
    this._queue(this.driver.viewport.bind(this.driver, width, height));

    return this;
  }

  inject(type, file) {
    this._queue(this.driver.inject.bind(this.driver, type, file));

    return this;
  }

  exists(selector) {
    var _this = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this.run();
      return yield _this.driver.exists(selector);
    })();
  }

  html() {
    var _this2 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      yield _this2.run();
      return yield _this2.driver.html();
    })();
  }

  evaluate(fn) {
    var _arguments = arguments,
        _this3 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      for (var _len = _arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
        args[_key - 1] = _arguments[_key];
      }

      yield _this3.run();
      return _this3.driver.evaluate(fn, ...args);
    })();
  }

  wait() {
    //@ts-ignore
    this._queue(() => this.driver.wait.apply(this.driver, arguments));

    return this;
  }

  header(header, value) {
    return this;
  }

  authentication(username, password) {
    this._queue(this.driver.authentication.bind(this.driver, username, password));

    return this;
  }

  useragent(useragent) {
    this._queue(this.driver.useragent.bind(this.driver, useragent));

    return this;
  }

  run() {
    var _this4 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      for (var block of _this4.queue) {
        yield block();
      }

      _this4.queue = [];
    })();
  }

  end() {
    var _this5 = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _this5.run();
    })();
  }

}

exports.Electrolizer = Electrolizer;
var _default = Electrolizer;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lbGVjdHJvbGl6ZXIuY2xhc3MudHMiXSwibmFtZXMiOlsiRWxlY3Ryb2xpemVyVHlwZSIsIkVsZWN0cm9saXplciIsImNvbnN0cnVjdG9yIiwiYnVzIiwiY2xlYXJBbGwiLCJfcXVldWUiLCJkcml2ZXIiLCJjb29raWVzIiwiZ2V0IiwiYXJnIiwic2V0IiwibmFtZSIsInZhbHVlIiwiY2xlYXIiLCJzZXR1cERyaXZlciIsImJ1c1R5cGUiLCJ3ZWJ2aWV3IiwiV2Vidmlld1RhZ0RyaXZlciIsImJyb3dzZXJXaW5kb3ciLCJCcm93c2VyV2luZG93RHJpdmVyIiwiYnJvd3NlclZpZXciLCJCcm93c2VyVmlld0RyaXZlciIsImluc3RhbmNlT2ZUZXN0IiwiQnJvd3NlclZpZXciLCJlcnJvciIsIkJyb3dzZXJXaW5kb3ciLCJmbiIsInF1ZXVlIiwicHVzaCIsImdvdG8iLCJ1cmwiLCJoZWFkZXJzIiwiYmluZCIsImJhY2siLCJmb3J3YXJkIiwicmVmcmVzaCIsImNsaWNrIiwic2VsZWN0b3IiLCJtb3VzZWRvd24iLCJtb3VzZXVwIiwibW91c2VvdmVyIiwibW91c2VvdXQiLCJ0eXBlIiwidGV4dCIsImluc2VydCIsImNoZWNrIiwidW5jaGVjayIsInNlbGVjdCIsIm9wdGlvbiIsInNjcm9sbFRvIiwidG9wIiwibGVmdCIsInZpZXdwb3J0Iiwid2lkdGgiLCJoZWlnaHQiLCJpbmplY3QiLCJmaWxlIiwiZXhpc3RzIiwicnVuIiwiaHRtbCIsImV2YWx1YXRlIiwiYXJncyIsIndhaXQiLCJhcHBseSIsImFyZ3VtZW50cyIsImhlYWRlciIsImF1dGhlbnRpY2F0aW9uIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsInVzZXJhZ2VudCIsImJsb2NrIiwiZW5kIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUE7O0FBRUE7O0lBSVlBLGdCOzs7V0FBQUEsZ0I7QUFBQUEsRUFBQUEsZ0I7QUFBQUEsRUFBQUEsZ0I7QUFBQUEsRUFBQUEsZ0I7R0FBQUEsZ0Is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LEdBQWEsRUFBYjtBQUx5QjtBQU0xQjs7QUFFSzRDLEVBQUFBLEdBQU4sR0FBMkI7QUFBQTs7QUFBQTtBQUN6QixNQUFBLE1BQUksQ0FBQ2IsR0FBTDtBQUR5QjtBQUUxQjs7QUE1TXlIOzs7ZUErTTdHekQsWSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJyb3dzZXJWaWV3LCBCcm93c2VyV2luZG93LCBXZWJ2aWV3VGFnLCBXZWJDb250ZW50cyB9IGZyb20gJ2VsZWN0cm9uJztcbmltcG9ydCB7IE9wZXJhdG9yRnVuY3Rpb25zIH0gZnJvbSAnLi9vcGVyYXRvci1mdW5jdGlvbnMuaW50ZXJmYWNlJztcbmltcG9ydCB7IFdlYnZpZXdUYWdEcml2ZXIsIEJyb3dzZXJWaWV3RHJpdmVyLCBCcm93c2VyV2luZG93RHJpdmVyIH0gZnJvbSAnLi9kcml2ZXJzJztcbmltcG9ydCB7IFB1c2ggfSBmcm9tICcuL2V2YWx1YXRlLWZ1bmN0aW9uLnR5cGUnO1xuaW1wb3J0IHsgQ29va2llcyB9IGZyb20gJy4vZHJpdmVycy9jb29raWVzLmludGVyZmFjZSc7XG5cbmV4cG9ydCBlbnVtIEVsZWN0cm9saXplclR5cGUge1xuICB3ZWJ2aWV3ID0gJ3dlYnZpZXcnLFxuICBicm93c2VyVmlldyA9ICdicm93c2VyVmlldycsXG4gIGJyb3dzZXJXaW5kb3cgPSAnYnJvd3NlcldpbmRvdydcbn1cblxuXG5leHBvcnQgY2xhc3MgRWxlY3Ryb2xpemVyPFQgZXh0ZW5kcyBXZWJ2aWV3VGFnIHwgQnJvd3NlclZpZXcgfCBCcm93c2VyV2luZG93PiBpbXBsZW1lbnRzIE9wZXJhdG9yRnVuY3Rpb25zPEVsZWN0cm9saXplcjxUPj4ge1xuXG4gIGludGVyYWN0aW9uUmVhZHk6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBxdWV1ZTogKCgpID0+IFByb21pc2U8YW55PilbXSA9IFtdO1xuXG4gIGRyaXZlciE6IFdlYnZpZXdUYWdEcml2ZXIgfCBCcm93c2VyV2luZG93RHJpdmVyIHwgQnJvd3NlclZpZXdEcml2ZXI7XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIGJ1czogVCl7XG4gICAgdGhpcy5zZXR1cERyaXZlcigpO1xuICB9XG5cbiAgY29va2llczogQ29va2llczxFbGVjdHJvbGl6ZXI8VD4+ID0ge1xuICAgIGNsZWFyQWxsOiAoKSA9PiB7IFxuICAgICAgdGhpcy5fcXVldWUoICgpID0+IHRoaXMuZHJpdmVyLmNvb2tpZXMuY2xlYXJBbGwoKSApO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBnZXQ6IChhcmc/OiBhbnkpID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmRyaXZlci5jb29raWVzLmdldChhcmcpXG4gICAgfSxcbiAgICBzZXQ6IChuYW1lOiBzdHJpbmcgfCBFbGVjdHJvbi5Db29raWUsIHZhbHVlPzogc3RyaW5nKSA9PiB7XG4gICAgICAvL0B0cy1pZ25vcmVcbiAgICAgIHRoaXMuX3F1ZXVlKCgpID0+IHRoaXMuZHJpdmVyLmNvb2tpZXMuc2V0KG5hbWUsIHZhbHVlKSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIGNsZWFyOiAobmFtZT86IHN0cmluZykgPT4ge1xuICAgICAgdGhpcy5fcXVldWUoKCkgPT4gdGhpcy5kcml2ZXIuY29va2llcy5jbGVhcihuYW1lKSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICB9XG5cbiAgXG4gIHByaXZhdGUgc2V0dXBEcml2ZXIoKXtcbiAgICBzd2l0Y2godGhpcy5idXNUeXBlKXtcbiAgICAgIGNhc2UgRWxlY3Ryb2xpemVyVHlwZS53ZWJ2aWV3OlxuICAgICAgICB0aGlzLmRyaXZlciA9IG5ldyBXZWJ2aWV3VGFnRHJpdmVyKHRoaXMuYnVzIGFzIFdlYnZpZXdUYWcpO1xuICAgICAgYnJlYWs7XG4gICAgICBcbiAgICAgIGNhc2UgRWxlY3Ryb2xpemVyVHlwZS5icm93c2VyV2luZG93OlxuICAgICAgICB0aGlzLmRyaXZlciA9IG5ldyBCcm93c2VyV2luZG93RHJpdmVyKHRoaXMuYnVzIGFzIEJyb3dzZXJXaW5kb3cpO1xuICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgRWxlY3Ryb2xpemVyVHlwZS5icm93c2VyVmlldzpcbiAgICAgICAgdGhpcy5kcml2ZXIgPSBuZXcgQnJvd3NlclZpZXdEcml2ZXIodGhpcy5idXMgYXMgQnJvd3NlclZpZXcpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBcbiAgZ2V0IGJ1c1R5cGUoKTogRWxlY3Ryb2xpemVyVHlwZSB7XG4gICAgdHJ5IHtcbiAgICAgIGxldCBpbnN0YW5jZU9mVGVzdCA9IHRoaXMuYnVzIGluc3RhbmNlb2YgQnJvd3NlclZpZXc7XG4gICAgfSBjYXRjaChlcnJvcil7XG4gICAgICByZXR1cm4gRWxlY3Ryb2xpemVyVHlwZS53ZWJ2aWV3O1xuICAgIH1cblxuICAgIGlmKHRoaXMuYnVzIGluc3RhbmNlb2YgQnJvd3NlclZpZXcpe1xuICAgICAgcmV0dXJuIEVsZWN0cm9saXplclR5cGUuYnJvd3NlclZpZXc7XG4gICAgfVxuXG4gICAgaWYodGhpcy5idXMgaW5zdGFuY2VvZiBCcm93c2VyV2luZG93KXtcbiAgICAgIHJldHVybiBFbGVjdHJvbGl6ZXJUeXBlLmJyb3dzZXJXaW5kb3c7XG4gICAgfVxuXG4gICAgcmV0dXJuIEVsZWN0cm9saXplclR5cGUud2VidmlldztcbiAgfVxuICBcbiAgcHJpdmF0ZSBfcXVldWUoZm46ICgpID0+IFByb21pc2U8YW55Pil7XG4gICAgdGhpcy5xdWV1ZS5wdXNoKGZuKTtcbiAgfVxuXG4gIGdvdG8odXJsOiBzdHJpbmcsIGhlYWRlcnM/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLl9xdWV1ZSh0aGlzLmRyaXZlci5nb3RvLmJpbmQodGhpcy5kcml2ZXIsIHVybCwgaGVhZGVycykpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYmFjaygpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMuX3F1ZXVlKHRoaXMuZHJpdmVyLmJhY2suYmluZCh0aGlzLmRyaXZlcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZm9yd2FyZCgpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMuX3F1ZXVlKHRoaXMuZHJpdmVyLmZvcndhcmQuYmluZCh0aGlzLmRyaXZlcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgcmVmcmVzaCgpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMuX3F1ZXVlKHRoaXMuZHJpdmVyLnJlZnJlc2guYmluZCh0aGlzLmRyaXZlcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgY2xpY2soc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIuY2xpY2suYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG1vdXNlZG93bihzZWxlY3Rvcjogc3RyaW5nKTogRWxlY3Ryb2xpemVyPFQ+IHtcbiAgICB0aGlzLl9xdWV1ZSh0aGlzLmRyaXZlci5tb3VzZWRvd24uYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG1vdXNldXAoc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIubW91c2V1cC5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgbW91c2VvdmVyKHNlbGVjdG9yOiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMuX3F1ZXVlKHRoaXMuZHJpdmVyLm1vdXNlb3Zlci5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgbW91c2VvdXQoc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIubW91c2VvdXQuYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHR5cGUoc2VsZWN0b3I6IHN0cmluZywgdGV4dD86IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIudHlwZS5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvciwgdGV4dCkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgaW5zZXJ0KHNlbGVjdG9yOiBzdHJpbmcsIHRleHQ/OiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMuX3F1ZXVlKHRoaXMuZHJpdmVyLmluc2VydC5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvciwgdGV4dCkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgY2hlY2soc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIuY2hlY2suYmluZCh0aGlzLmRyaXZlciwgc2VsZWN0b3IpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHVuY2hlY2soc2VsZWN0b3I6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIudW5jaGVjay5iaW5kKHRoaXMuZHJpdmVyLCBzZWxlY3RvcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgc2VsZWN0KHNlbGVjdG9yOiBzdHJpbmcsIG9wdGlvbj86IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIuc2VsZWN0LmJpbmQodGhpcy5kcml2ZXIsIHNlbGVjdG9yLCBvcHRpb24pKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHNjcm9sbFRvKHRvcDogbnVtYmVyLCBsZWZ0OiBudW1iZXIpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMuX3F1ZXVlKHRoaXMuZHJpdmVyLnNjcm9sbFRvLmJpbmQodGhpcy5kcml2ZXIsIHRvcCwgbGVmdCkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgdmlld3BvcnQod2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMuX3F1ZXVlKHRoaXMuZHJpdmVyLnZpZXdwb3J0LmJpbmQodGhpcy5kcml2ZXIsIHdpZHRoLCBoZWlnaHQpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGluamVjdCh0eXBlOiAnanMnIHwgJ2NzcycsIGZpbGU6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIuaW5qZWN0LmJpbmQodGhpcy5kcml2ZXIsIHR5cGUsIGZpbGUpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGFzeW5jIGV4aXN0cyhzZWxlY3Rvcjogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgYXdhaXQgdGhpcy5ydW4oKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5kcml2ZXIuZXhpc3RzKHNlbGVjdG9yKTtcbiAgfVxuXG4gIGFzeW5jIGh0bWwoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBhd2FpdCB0aGlzLnJ1bigpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmRyaXZlci5odG1sKCk7XG4gIH1cblxuICBhc3luYyBldmFsdWF0ZTxULCBLIGV4dGVuZHMgYW55W10sIFI+KGZuOiAoLi4uYXJnczogUHVzaDxLLCBUPikgPT4gUiwgLi4uYXJnczogSyk6IFByb21pc2U8Uj4ge1xuICAgIGF3YWl0IHRoaXMucnVuKCk7XG4gICAgcmV0dXJuIHRoaXMuZHJpdmVyLmV2YWx1YXRlKGZuLCAuLi5hcmdzKTtcbiAgfVxuXG4gIHdhaXQobXM6IG51bWJlcik6IEVsZWN0cm9saXplcjxUPlxuICB3YWl0KHNlbGVjdG9yOiBzdHJpbmcsIGRlbGF5PzogbnVtYmVyKTogRWxlY3Ryb2xpemVyPFQ+XG4gIHdhaXQ8UiwgSyBleHRlbmRzIGFueVtdPihmbjogKC4uLmFyZ3M6IFB1c2g8SywgUj4pID0+IGJvb2xlYW4gfCBQcm9taXNlPGJvb2xlYW4+ICwgLi4uYXJnczogSyk6IEVsZWN0cm9saXplcjxUPlxuICB3YWl0KCk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgLy9AdHMtaWdub3JlXG4gICAgdGhpcy5fcXVldWUoKCkgPT4gdGhpcy5kcml2ZXIud2FpdC5hcHBseSh0aGlzLmRyaXZlciwgYXJndW1lbnRzKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBoZWFkZXIoaGVhZGVyOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYXV0aGVudGljYXRpb24odXNlcm5hbWU6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZyk6IEVsZWN0cm9saXplcjxUPiB7XG4gICAgdGhpcy5fcXVldWUodGhpcy5kcml2ZXIuYXV0aGVudGljYXRpb24uYmluZCh0aGlzLmRyaXZlciwgdXNlcm5hbWUsIHBhc3N3b3JkKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICB1c2VyYWdlbnQodXNlcmFnZW50OiBzdHJpbmcpOiBFbGVjdHJvbGl6ZXI8VD4ge1xuICAgIHRoaXMuX3F1ZXVlKHRoaXMuZHJpdmVyLnVzZXJhZ2VudC5iaW5kKHRoaXMuZHJpdmVyLCB1c2VyYWdlbnQpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGFzeW5jIHJ1bigpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBmb3IobGV0IGJsb2NrIG9mIHRoaXMucXVldWUpe1xuICAgICAgYXdhaXQgYmxvY2soKTtcbiAgICB9XG5cbiAgICB0aGlzLnF1ZXVlID0gW107XG4gIH1cblxuICBhc3luYyBlbmQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5ydW4oKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBFbGVjdHJvbGl6ZXI7Il19